const __vite__mapDeps=(i,m=__vite__mapDeps,d=m.f||(m.f=["./observers.js","./shopify.js","./iterable.js","./analytics-data.js","./rudderstack-client.js","./cookies.js","./validator.js","./use-viewport-size.js","./vue.esm-bundler.js","./rudderstack-ready-api.js"]))=>i.map(i2=>d[i2]);import{i as fe,S as kr,e as ht,w as It}from"./shopify.js";import"./iterable.js";import{t as Or,a as Mr}from"./analytics-data.js";import{i as xr,m as rr,a as nr,p as Ur,Q as oe,r as Br,g as Nr,s as qr}from"./rudderstack-client.js";import{r as gt,C as pt,o as Fr}from"./rudderstack-ready-api.js";import"./cookies.js";import"./validator.js";import"./use-viewport-size.js";import"./vue.esm-bundler.js";const Rt=()=>{var t,e,r,n;if(!window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled&&window.ALLBIRDS.OneTrust.hasPerformanceConsent()){fe("[Allbirds pixel] - RudderStack Page Load - sending analytics events");const o=rr();nr({additionalTraits:{fbclid:o.fbclid,gclid:o.gclid,msclkid:o.msclkid},forceIdentify:!0}),Ur(((e=(t=window.ALLBIRDS)==null?void 0:t.page)==null?void 0:e.template)||"","",{client_platform:"liquid"}),((n=(r=window.ALLBIRDS)==null?void 0:r.page)==null?void 0:n.template)==kr.COLLECTION&&(Or(),Mr()),window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled=!0}},Kr=()=>{document.addEventListener("DOMContentLoaded",()=>{fe("[Allbirds pixel] - RudderStack Page Load - page load event"),window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled=!1,xr(),gt(()=>{fe("[Allbirds pixel] - RudderStack Page Load - rudderstack ready event",{isIdentifyAndPageCalled:window.ALLBIRDS.Rudderstack.isIdentifyAndPageCalled}),window.ALLBIRDS.OneTrust.isOneTrustActiveGroupsReady()?Rt():window.ALLBIRDS.OneTrust.onConsentChange(()=>{Rt()})},pt.RUDDERSTACK_PAGE_LOAD)})},_t=()=>window.location.search.includes(oe.EVENT_NAME_PARAM),Ct=(t,e)=>{window.ALLBIRDS.OneTrust.hasPerformanceConsent()&&(fe("[Allbirds pixel] - RudderStack Query String API - sending analytics event",{eventName:t,eventProps:e}),window.rudderanalytics.track(t,e))},Gr=()=>{document.addEventListener("DOMContentLoaded",()=>{gt(()=>{if(fe("[Allbirds pixel] - RudderStack Query String API - rudderstack ready event",{queryStringApi:_t()}),_t())try{const t={},r=new URL(window.location.href).searchParams,n=r.get(oe.EVENT_NAME_PARAM);for(const[i,s]of r.entries())if(i.startsWith(oe.EVENT_PROP_PREFIX_PARAM)){const a=i.substring(oe.EVENT_PROP_PREFIX_PARAM.length);let u=s;if(s.startsWith(oe.PROP_TYPE_OBJECT_PREFIX)){const l=s.replace(oe.PROP_TYPE_OBJECT_PREFIX,"");u=JSON.parse(l)}a&&(t[a]=u)}window.ALLBIRDS.OneTrust.isOneTrustActiveGroupsReady()?Ct(n,t):window.ALLBIRDS.OneTrust.onConsentChange(()=>{Ct(n,t)});const o=[oe.EVENT_NAME_PARAM,...Object.keys(t).map(i=>`${oe.EVENT_PROP_PREFIX_PARAM}${i}`)];Br(o)}catch(t){ht("[Allbirds pixel] - RudderStack Query String API - executeQueryStringApi - error parsing",{currentUrl:window.location.href},t)}},pt.RUDDERSTACK_QUERY_STRING_API)})},we=window.ALLBIRDS.environment.types,Pt={[`${we.PRODUCTION}-UK`]:"1wsEvk2JSySDpu4GkRrODFa3wfu",[`${we.PRODUCTION}-US`]:"1wsEr0lioiZzgx5iZd40tVWiUJI",[we.DEVELOPMENT]:"1xEmwnbSXytFtBkBAc7P0e79vg1",[we.STAGING]:"1rPF2XhPLMKZS39MROI5nrujMIY"},Wr="https://api.rudderstack.com",Vr="https://allbirds-dataplane.rudderstack.com",zr="oneTrust",Tt="https://cdn.rudderlabs.com/v3",{env:$r,shopId:Xr}=window.ALLBIRDS.environment,Qr=Pt[`${$r}-${Xr}`]||Pt[we.DEVELOPMENT];let Lt=!1;const jr=(t,e,r)=>{let i=1;const s=setInterval(function(){window.rudderanalytics&&window.rudderanalytics.load?(window.rudderanalytics.load(t,e,r),clearInterval(s),fe(`[Allbirds pixel] - Rudderstack SDK - calling sdk.load() function - after ${i} attempts`)):(i>60&&(clearInterval(s),ht(`[Allbirds pixel] - Rudderstack SDK - could not be loaded - after ${i} attempts`,{},new Error("Rudderstack SDK could not be loaded"))),i++)},1e3)},Hr=()=>{const t=()=>{window.ALLBIRDS.Rudderstack.notifyConsentChange(window.ALLBIRDS.OneTrust.hasPerformanceConsent())};window.ALLBIRDS.Rudderstack&&window.ALLBIRDS.OneTrust?window.ALLBIRDS.OneTrust.isOneTrustActiveGroupsReady()?t():window.ALLBIRDS.OneTrust.onConsentChange(()=>{t()}):ht("[Allbirds pixel] - Rudderstack SDK - could not notify consent change, OneTrust and Rudderstack SDKs are not loaded",{windowAllbirdsOneTrust:window.ALLBIRDS.OneTrust,windowAllbirdsRudderstack:window.ALLBIRDS.Rudderstack},new Error("OneTrust and Rudderstack SDKs are not loaded"))},Yr=()=>{if(!Lt){const t={configUrl:Wr,consentManagement:{enabled:!0,provider:zr},destSDKBaseURL:`${Tt}/${window.rudderAnalyticsBuildType}/js-integrations`,loadIntegration:!1,logLevel:window.ALLBIRDS.settings.rudderstack.logLevel||"DEBUG",onLoaded:()=>{Hr(),fe("[Allbirds pixel] - Rudderstack SDK - load event")},pluginsSDKBaseURL:`${Tt}/${window.rudderAnalyticsBuildType}/plugins`,preConsent:{enabled:!0,events:{delivery:"buffer"},storage:{strategy:"session"}},storage:{encryption:{version:"legacy"}}};jr(Qr,Vr,t),Lt=!0}};Yr(),Kr(),Gr(),Fr();var et=function(t,e){return et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},et(t,e)};function Fe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");et(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var T=function(){return T=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},T.apply(this,arguments)};function C(t,e,r,n){function o(i){return i instanceof r?i:new r(function(s){s(i)})}return new(r||(r=Promise))(function(i,s){function a(c){try{l(n.next(c))}catch(v){s(v)}}function u(c){try{l(n.throw(c))}catch(v){s(v)}}function l(c){c.done?i(c.value):o(c.value).then(a,u)}l((n=n.apply(t,e||[])).next())})}function _(t,e){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(n=1,o&&(i=l[0]&2?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(c){l=[6,c],o=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function V(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}function ve(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,i;n<o;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var Zr="AMP",Jr="".concat(Zr,"_unsent"),ir="https://api2.amplitude.com/2/httpapi",en="https://api.eu.amplitude.com/2/httpapi",tn="https://api2.amplitude.com/batch",rn="https://api.eu.amplitude.com/batch",U;(function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"})(U||(U={}));var j=function(){var t="ampIntegrationContext";if(typeof globalThis<"u"&&typeof globalThis[t]<"u")return globalThis[t];if(typeof globalThis<"u")return globalThis;if(typeof window<"u")return window;if(typeof self<"u")return self;if(typeof global<"u")return global},At=function(t){return{promise:t||Promise.resolve()}},$;(function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Verbose=3]="Verbose",t[t.Debug=4]="Debug"})($||($={}));var Te="Amplitude Logger ",Ue=function(){function t(){this.logLevel=$.None}return t.prototype.disable=function(){this.logLevel=$.None},t.prototype.enable=function(e){e===void 0&&(e=$.Warn),this.logLevel=e},t.prototype.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<$.Verbose||console.log("".concat(Te,"[Log]: ").concat(e.join(" ")))},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<$.Warn||console.warn("".concat(Te,"[Warn]: ").concat(e.join(" ")))},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<$.Error||console.error("".concat(Te,"[Error]: ").concat(e.join(" ")))},t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.logLevel<$.Debug||console.log("".concat(Te,"[Debug]: ").concat(e.join(" ")))},t}(),Oe=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:"$default_instance",logLevel:$.Warn,loggerProvider:new Ue,offline:!1,optOut:!1,serverUrl:ir,serverZone:"US",useBatch:!1}},nn=function(){function t(e){var r,n,o,i;this._optOut=!1;var s=Oe();this.apiKey=e.apiKey,this.flushIntervalMillis=(r=e.flushIntervalMillis)!==null&&r!==void 0?r:s.flushIntervalMillis,this.flushMaxRetries=e.flushMaxRetries||s.flushMaxRetries,this.flushQueueSize=e.flushQueueSize||s.flushQueueSize,this.instanceName=e.instanceName||s.instanceName,this.loggerProvider=e.loggerProvider||s.loggerProvider,this.logLevel=(n=e.logLevel)!==null&&n!==void 0?n:s.logLevel,this.minIdLength=e.minIdLength,this.plan=e.plan,this.ingestionMetadata=e.ingestionMetadata,this.offline=e.offline!==void 0?e.offline:s.offline,this.optOut=(o=e.optOut)!==null&&o!==void 0?o:s.optOut,this.serverUrl=e.serverUrl,this.serverZone=e.serverZone||s.serverZone,this.storageProvider=e.storageProvider,this.transportProvider=e.transportProvider,this.useBatch=(i=e.useBatch)!==null&&i!==void 0?i:s.useBatch,this.loggerProvider.enable(this.logLevel);var a=sn(e.serverUrl,e.serverZone,e.useBatch);this.serverZone=a.serverZone,this.serverUrl=a.serverUrl}return Object.defineProperty(t.prototype,"optOut",{get:function(){return this._optOut},set:function(e){this._optOut=e},enumerable:!1,configurable:!0}),t}(),on=function(t,e){return t==="EU"?e?rn:en:e?tn:ir},sn=function(t,e,r){if(t===void 0&&(t=""),e===void 0&&(e=Oe().serverZone),r===void 0&&(r=Oe().useBatch),t)return{serverUrl:t,serverZone:void 0};var n=["US","EU"].includes(e)?e:Oe().serverZone;return{serverZone:n,serverUrl:on(n,r)}},an=function(){function t(){}return t.prototype.getApplicationContext=function(){return{versionName:this.versionName,language:un(),platform:"Web",os:void 0,deviceModel:void 0}},t}(),un=function(){return typeof navigator<"u"&&(navigator.languages&&navigator.languages[0]||navigator.language)||""},ln=function(){function t(){this.queue=[]}return t.prototype.logEvent=function(e){this.receiver?this.receiver(e):this.queue.length<512&&this.queue.push(e)},t.prototype.setEventReceiver=function(e){this.receiver=e,this.queue.length>0&&(this.queue.forEach(function(r){e(r)}),this.queue=[])},t}(),se=function(){return se=Object.assign||function(e){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},se.apply(this,arguments)};function Me(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dt(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,i=[],s;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(a){s={error:a}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return i}var xe=function(t,e){var r,n,o=["string","number","boolean","undefined"],i=typeof t,s=typeof e;if(i!==s)return!1;try{for(var a=Me(o),u=a.next();!u.done;u=a.next()){var l=u.value;if(l===i)return t===e}}catch(E){r={error:E}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;var c=Array.isArray(t),v=Array.isArray(e);if(c!==v)return!1;if(c&&v){for(var d=0;d<t.length;d++)if(!xe(t[d],e[d]))return!1}else{var f=Object.keys(t).sort(),h=Object.keys(e).sort();if(!xe(f,h))return!1;var g=!0;return Object.keys(t).forEach(function(E){xe(t[E],e[E])||(g=!1)}),g}return!0},cn="$set",dn="$unset",fn="$clearAll";Object.entries||(Object.entries=function(t){for(var e=Object.keys(t),r=e.length,n=new Array(r);r--;)n[r]=[e[r],t[e[r]]];return n});var vn=function(){function t(){this.identity={userProperties:{}},this.listeners=new Set}return t.prototype.editIdentity=function(){var e=this,r=se({},this.identity.userProperties),n=se(se({},this.identity),{userProperties:r});return{setUserId:function(o){return n.userId=o,this},setDeviceId:function(o){return n.deviceId=o,this},setUserProperties:function(o){return n.userProperties=o,this},setOptOut:function(o){return n.optOut=o,this},updateUserProperties:function(o){var i,s,a,u,l,c,v=n.userProperties||{};try{for(var d=Me(Object.entries(o)),f=d.next();!f.done;f=d.next()){var h=Dt(f.value,2),g=h[0],E=h[1];switch(g){case cn:try{for(var I=(a=void 0,Me(Object.entries(E))),m=I.next();!m.done;m=I.next()){var b=Dt(m.value,2),w=b[0],R=b[1];v[w]=R}}catch(y){a={error:y}}finally{try{m&&!m.done&&(u=I.return)&&u.call(I)}finally{if(a)throw a.error}}break;case dn:try{for(var S=(l=void 0,Me(Object.keys(E))),p=S.next();!p.done;p=S.next()){var w=p.value;delete v[w]}}catch(y){l={error:y}}finally{try{p&&!p.done&&(c=S.return)&&c.call(S)}finally{if(l)throw l.error}}break;case fn:v={};break}}}catch(y){i={error:y}}finally{try{f&&!f.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}return n.userProperties=v,this},commit:function(){return e.setIdentity(n),this}}},t.prototype.getIdentity=function(){return se({},this.identity)},t.prototype.setIdentity=function(e){var r=se({},this.identity);this.identity=se({},e),xe(r,this.identity)||this.listeners.forEach(function(n){n(e)})},t.prototype.addIdentityListener=function(e){this.listeners.add(e)},t.prototype.removeIdentityListener=function(e){this.listeners.delete(e)},t}(),Se=typeof globalThis<"u"?globalThis:typeof global<"u"?global:self,hn=function(){function t(){this.identityStore=new vn,this.eventBridge=new ln,this.applicationContextProvider=new an}return t.getInstance=function(e){return Se.analyticsConnectorInstances||(Se.analyticsConnectorInstances={}),Se.analyticsConnectorInstances[e]||(Se.analyticsConnectorInstances[e]=new t),Se.analyticsConnectorInstances[e]},t}(),gn=function(t){return t===void 0&&(t="$default_instance"),hn.getInstance(t)},pn=function(t){var e=new Error().stack||"";return e.split(`
`).slice(2+t).map(function(r){return r.trim()})},pe=function(t,e,r,n,o){return o===void 0&&(o=null),function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var a=r(),u=a.logger,l=a.logLevel;if(l&&l<$.Debug||!l||!u)return t.apply(o,i);var c={type:"invoke public method",name:e,args:i,stacktrace:pn(1),time:{start:new Date().toISOString()},states:{}},v=t.apply(o,i);return v&&v.promise?v.promise.then(function(){c.time&&(c.time.end=new Date().toISOString()),u.debug(JSON.stringify(c,null,2))}):(c.time&&(c.time.end=new Date().toISOString()),u.debug(JSON.stringify(c,null,2))),v}},or=function(){function t(){}return t.prototype.send=function(e,r){return Promise.resolve(null)},t.prototype.buildResponse=function(e){var r,n,o,i,s,a,u,l,c,v,d,f,h,g,E,I,m,b,w,R,S,p;if(typeof e!="object")return null;var y=e.code||0,P=this.buildStatus(y);switch(P){case U.Success:return{status:P,statusCode:y,body:{eventsIngested:(r=e.events_ingested)!==null&&r!==void 0?r:0,payloadSizeBytes:(n=e.payload_size_bytes)!==null&&n!==void 0?n:0,serverUploadTime:(o=e.server_upload_time)!==null&&o!==void 0?o:0}};case U.Invalid:return{status:P,statusCode:y,body:{error:(i=e.error)!==null&&i!==void 0?i:"",missingField:(s=e.missing_field)!==null&&s!==void 0?s:"",eventsWithInvalidFields:(a=e.events_with_invalid_fields)!==null&&a!==void 0?a:{},eventsWithMissingFields:(u=e.events_with_missing_fields)!==null&&u!==void 0?u:{},eventsWithInvalidIdLengths:(l=e.events_with_invalid_id_lengths)!==null&&l!==void 0?l:{},epsThreshold:(c=e.eps_threshold)!==null&&c!==void 0?c:0,exceededDailyQuotaDevices:(v=e.exceeded_daily_quota_devices)!==null&&v!==void 0?v:{},silencedDevices:(d=e.silenced_devices)!==null&&d!==void 0?d:[],silencedEvents:(f=e.silenced_events)!==null&&f!==void 0?f:[],throttledDevices:(h=e.throttled_devices)!==null&&h!==void 0?h:{},throttledEvents:(g=e.throttled_events)!==null&&g!==void 0?g:[]}};case U.PayloadTooLarge:return{status:P,statusCode:y,body:{error:(E=e.error)!==null&&E!==void 0?E:""}};case U.RateLimit:return{status:P,statusCode:y,body:{error:(I=e.error)!==null&&I!==void 0?I:"",epsThreshold:(m=e.eps_threshold)!==null&&m!==void 0?m:0,throttledDevices:(b=e.throttled_devices)!==null&&b!==void 0?b:{},throttledUsers:(w=e.throttled_users)!==null&&w!==void 0?w:{},exceededDailyQuotaDevices:(R=e.exceeded_daily_quota_devices)!==null&&R!==void 0?R:{},exceededDailyQuotaUsers:(S=e.exceeded_daily_quota_users)!==null&&S!==void 0?S:{},throttledEvents:(p=e.throttled_events)!==null&&p!==void 0?p:[]}};case U.Timeout:default:return{status:P,statusCode:y}}},t.prototype.buildStatus=function(e){return e>=200&&e<300?U.Success:e===429?U.RateLimit:e===413?U.PayloadTooLarge:e===408?U.Timeout:e>=400&&e<500?U.Invalid:e>=500?U.Failed:U.Unknown},t}(),yn=function(t){Fe(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.send=function(r,n){return C(this,void 0,void 0,function(){var o,i,s;return _(this,function(a){switch(a.label){case 0:if(typeof fetch>"u")throw new Error("FetchTransport is not supported");return o={headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(n),method:"POST"},[4,fetch(r,o)];case 1:return i=a.sent(),[4,i.text()];case 2:s=a.sent();try{return[2,this.buildResponse(JSON.parse(s))]}catch{return[2,this.buildResponse({code:i.status})]}return[2]}})})},e}(or),Ce;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(Ce||(Ce={}));var sr="[Amplitude]",mn="".concat(sr," Session Replay ID"),Sn=0,En=Ce.US,bn={enabled:!0},ar=1e3,wn="".concat(sr," Session Replay Debug"),In="amp-block",ur="amp-mask",Rn="amp-unmask",_n="https://api-sr.amplitude.com/sessions/v2/track",Cn="https://api-sr.eu.amplitude.com/sessions/v2/track",Pn="https://api-sr.stag2.amplitude.com/sessions/v2/track",Tn=1*1e6,Ln=3e4,An=6e4,Dn=500,kn=10*1e3,lr=1024,On=1e3,ce;(function(t){t.GET_SR_PROPS="get-sr-props",t.DEBUG_INFO="debug-info",t.FETCH_REQUEST="fetch-request",t.METADATA="metadata"})(ce||(ce={}));var tt=function(){function t(e){this.logger=e,this.log=this.getSafeMethod("log"),this.warn=this.getSafeMethod("warn"),this.error=this.getSafeMethod("error"),this.debug=this.getSafeMethod("debug")}return t.prototype.getSafeMethod=function(e){var r;if(!this.logger)return function(){};var n=this.logger[e];if(typeof n=="function"){var o=(r=n.__rrweb_original__)!==null&&r!==void 0?r:n;return o.bind(this.logger)}return function(){}},t.prototype.enable=function(e){this.logger.enable(e)},t.prototype.disable=function(){this.logger.disable()},t}(),rt="medium";function Mn(t){return t.toLowerCase()}function xn(t){var e=t.type;return t.hasAttribute("data-rr-is-password")?"password":e?Mn(e):null}var cr=function(t,e,r){switch(e){case"light":{if(t!=="input")return!0;var n=r?xn(r):"";return n?!!(["password","hidden","email","tel"].includes(n)||r.autocomplete.startsWith("cc-")):!1}case"medium":case"conservative":return!0;default:return cr(t,rt,r)}},Un=function(t,e,r){var n,o,i;if(e===void 0&&(e={defaultMaskLevel:rt}),r){if(r.closest("."+ur))return!0;var s=((n=e.maskSelector)!==null&&n!==void 0?n:[]).some(function(u){return r.closest(u)});if(s)return!0;if(r.closest("."+Rn))return!1;var a=((o=e.unmaskSelector)!==null&&o!==void 0?o:[]).some(function(u){return r.closest(u)});if(a)return!1}return cr(t,(i=e.defaultMaskLevel)!==null&&i!==void 0?i:rt,r)},kt=function(t,e){return function(r,n){return Un(t,e,n)?r.replace(/[^\s]/g,"*"):r}},nt=function(t){var e=0;if(t.length===0)return e;for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e|=0}return e},Bn=function(t,e){var r=nt(t.toString()),n=Math.abs(r),o=n*31,i=o%1e6;return i/1e6<e},Nn=function(){var t=j();return t!=null&&t.location?t.location.href:""},qn=function(t,e){return"".concat(e,"/").concat(t)},dr=function(t,e){return e||(t===Ce.STAGING?Pn:t===Ce.EU?Cn:_n)},Fn=function(t){if(typeof t!="string"||t.trim()==="")return!1;var e=/^\/|^https?:\/\/[^\s]+$/;return!!e.test(t)},Kn=function(t){var e=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp("^".concat(e,"$"))},Gn=function(t){if(!t.every(function(e){return typeof e.selector=="string"&&typeof e.replacement=="string"}))throw new Error("ugcFilterRules must be an array of objects with selector and replacement properties");if(!t.every(function(e){return Fn(e.selector)}))throw new Error("ugcFilterRules must be an array of objects with valid globs")},Ke=function(t,e){var r,n;try{for(var o=V(e),i=o.next();!i.done;i=o.next()){var s=i.value,a=Kn(s.selector);if(a.test(t))return t.replace(a,s.replacement)}}catch(u){r={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t},fr=function(){return C(void 0,void 0,void 0,function(){var t,e,r,n,o,i,s;return _(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t=j(),t?[4,t.navigator.storage.estimate()]:[3,2];case 1:return e=a.sent(),r=e.usage,n=e.quota,o=e.usageDetails,i=r?Math.round(r/lr):0,s=r&&n?Math.round((r/n+Number.EPSILON)*1e3)/1e3:0,[2,{totalStorageSize:i,percentOfQuota:s,usageDetails:JSON.stringify(o)}];case 2:return[3,4];case 3:return a.sent(),[3,4];case 4:return[2,{totalStorageSize:0,percentOfQuota:0,usageDetails:""}]}})})},vr=function(t){var e=T({},t),r=e.apiKey;return e.apiKey="****".concat(r.substring(r.length-4)),e},hr=function(){return{flushMaxRetries:2,logLevel:$.Warn,loggerProvider:new Ue,transportProvider:new yn}},Wn=function(t){Fe(e,t);function e(r,n){var o=this,i,s,a,u,l,c=hr();return o=t.call(this,T(T({transportProvider:c.transportProvider,loggerProvider:new tt(n.loggerProvider||c.loggerProvider)},n),{apiKey:r}))||this,o.flushMaxRetries=n.flushMaxRetries!==void 0&&n.flushMaxRetries<=c.flushMaxRetries?n.flushMaxRetries:c.flushMaxRetries,o.apiKey=r,o.sampleRate=n.sampleRate||Sn,o.serverZone=n.serverZone||En,o.configServerUrl=n.configServerUrl,o.trackServerUrl=n.trackServerUrl,o.shouldInlineStylesheet=n.shouldInlineStylesheet,o.version=n.version,o.performanceConfig=n.performanceConfig||bn,o.storeType=(i=n.storeType)!==null&&i!==void 0?i:"idb",o.applyBackgroundColorToBlockedElements=(s=n.applyBackgroundColorToBlockedElements)!==null&&s!==void 0?s:!1,o.enableUrlChangePolling=(a=n.enableUrlChangePolling)!==null&&a!==void 0?a:!1,o.urlChangePollingInterval=(u=n.urlChangePollingInterval)!==null&&u!==void 0?u:ar,o.captureDocumentTitle=(l=n.captureDocumentTitle)!==null&&l!==void 0?l:!1,n.privacyConfig&&(o.privacyConfig=n.privacyConfig),n.interactionConfig&&(o.interactionConfig=n.interactionConfig,o.interactionConfig.ugcFilterRules&&Gn(o.interactionConfig.ugcFilterRules)),n.debugMode&&(o.debugMode=n.debugMode),n.experimental&&(o.experimental=n.experimental),n.omitElementTags&&(o.omitElementTags=n.omitElementTags),o}return e}(nn);const Vn="modulepreload",zn=function(t,e){return new URL(t,e).href},Ot={},ze=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");o=Promise.allSettled(r.map(l=>{if(l=zn(l,n),l in Ot)return;Ot[l]=!0;const c=l.endsWith(".css"),v=c?'[rel="stylesheet"]':"";if(n)for(let h=s.length-1;h>=0;h--){const g=s[h];if(g.href===l&&(!c||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${v}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":Vn,c||(f.as="script"),f.crossOrigin="",f.href=l,u&&f.setAttribute("nonce",u),document.head.appendChild(f),c)return new Promise((h,g)=>{f.addEventListener("load",h),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return o.then(s=>{for(const a of s||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};var gr=(t=>(t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t))(gr||{}),pr=(t=>(t[t.MouseUp=0]="MouseUp",t[t.MouseDown=1]="MouseDown",t[t.Click=2]="Click",t[t.ContextMenu=3]="ContextMenu",t[t.DblClick=4]="DblClick",t[t.Focus=5]="Focus",t[t.Blur=6]="Blur",t[t.TouchStart=7]="TouchStart",t[t.TouchMove_Departed=8]="TouchMove_Departed",t[t.TouchEnd=9]="TouchEnd",t[t.TouchCancel=10]="TouchCancel",t))(pr||{}),Be;(function(t){t.US="US",t.EU="EU",t.STAGING="STAGING"})(Be||(Be={}));var B;(function(t){t.Unknown="unknown",t.Skipped="skipped",t.Success="success",t.RateLimit="rate_limit",t.PayloadTooLarge="payload_too_large",t.Invalid="invalid",t.Failed="failed",t.Timeout="Timeout",t.SystemError="SystemError"})(B||(B={}));var $n=function(){function t(){}return t.prototype.send=function(e,r){return Promise.resolve(null)},t.prototype.buildResponse=function(e){var r,n,o,i,s,a,u,l,c,v,d,f,h,g,E,I,m,b,w,R,S,p;if(typeof e!="object")return null;var y=e.code||0,P=this.buildStatus(y);switch(P){case B.Success:return{status:P,statusCode:y,body:{eventsIngested:(r=e.events_ingested)!==null&&r!==void 0?r:0,payloadSizeBytes:(n=e.payload_size_bytes)!==null&&n!==void 0?n:0,serverUploadTime:(o=e.server_upload_time)!==null&&o!==void 0?o:0}};case B.Invalid:return{status:P,statusCode:y,body:{error:(i=e.error)!==null&&i!==void 0?i:"",missingField:(s=e.missing_field)!==null&&s!==void 0?s:"",eventsWithInvalidFields:(a=e.events_with_invalid_fields)!==null&&a!==void 0?a:{},eventsWithMissingFields:(u=e.events_with_missing_fields)!==null&&u!==void 0?u:{},eventsWithInvalidIdLengths:(l=e.events_with_invalid_id_lengths)!==null&&l!==void 0?l:{},epsThreshold:(c=e.eps_threshold)!==null&&c!==void 0?c:0,exceededDailyQuotaDevices:(v=e.exceeded_daily_quota_devices)!==null&&v!==void 0?v:{},silencedDevices:(d=e.silenced_devices)!==null&&d!==void 0?d:[],silencedEvents:(f=e.silenced_events)!==null&&f!==void 0?f:[],throttledDevices:(h=e.throttled_devices)!==null&&h!==void 0?h:{},throttledEvents:(g=e.throttled_events)!==null&&g!==void 0?g:[]}};case B.PayloadTooLarge:return{status:P,statusCode:y,body:{error:(E=e.error)!==null&&E!==void 0?E:""}};case B.RateLimit:return{status:P,statusCode:y,body:{error:(I=e.error)!==null&&I!==void 0?I:"",epsThreshold:(m=e.eps_threshold)!==null&&m!==void 0?m:0,throttledDevices:(b=e.throttled_devices)!==null&&b!==void 0?b:{},throttledUsers:(w=e.throttled_users)!==null&&w!==void 0?w:{},exceededDailyQuotaDevices:(R=e.exceeded_daily_quota_devices)!==null&&R!==void 0?R:{},exceededDailyQuotaUsers:(S=e.exceeded_daily_quota_users)!==null&&S!==void 0?S:{},throttledEvents:(p=e.throttled_events)!==null&&p!==void 0?p:[]}};case B.Timeout:default:return{status:P,statusCode:y}}},t.prototype.buildStatus=function(e){return e>=200&&e<300?B.Success:e===429?B.RateLimit:e===413?B.PayloadTooLarge:e===408?B.Timeout:e>=400&&e<500?B.Invalid:e>=500?B.Failed:B.Unknown},t}(),Xn="Network error occurred, remote config fetch failed",Qn="Remote config successfully fetched",jn="Remote config fetch rejected due to exceeded retry count",Mt="Remote config fetch rejected due to timeout after 5 seconds",xt="Unexpected error occurred",Hn="https://sr-client-cfg.amplitude.com/config",Yn="https://sr-client-cfg.stag2.amplitude.com/config",Zn="https://sr-client-cfg.eu.amplitude.com/config",Jn=function(){function t(e){var r=e.localConfig,n=e.configKeys,o=this;this.retryTimeout=1e3,this.attempts=0,this.sessionTargetingMatch=!1,this.metrics={},this.getRemoteNamespaceConfig=function(i,s){return C(o,void 0,void 0,function(){var a,u,l;return _(this,function(c){switch(c.label){case 0:return a=Date.now(),[4,this.fetchWithTimeout(s)];case 1:return u=c.sent(),u&&(l=u.configs&&u.configs[i],l)?(this.metrics.fetchTimeAPISuccess=Date.now()-a,[2,l]):(this.metrics.fetchTimeAPIFail=Date.now()-a,[2,void 0])}})})},this.getRemoteConfig=function(i,s,a){return C(o,void 0,void 0,function(){var u;return _(this,function(l){switch(l.label){case 0:return[4,this.getRemoteNamespaceConfig(i,a)];case 1:return u=l.sent(),[2,u?.[s]]}})})},this.fetchWithTimeout=function(i){return C(o,void 0,void 0,function(){var s,a,u;return _(this,function(l){switch(l.label){case 0:return s=new AbortController,a=setTimeout(function(){return s.abort()},5e3),[4,this.fetchRemoteConfig(s.signal,i)];case 1:return u=l.sent(),clearTimeout(a),[2,u]}})})},this.fetchRemoteConfig=function(i,s){return C(o,void 0,void 0,function(){var a,u,l,c,v,d,f,h,g,E,I,m,b;return _(this,function(w){switch(w.label){case 0:if(s===this.lastFetchedSessionId&&this.attempts>=this.localConfig.flushMaxRetries)return[2,this.completeRequest({err:jn})];if(i.aborted)return[2,this.completeRequest({err:Mt})];s!==this.lastFetchedSessionId&&(this.lastFetchedSessionId=s,this.attempts=0),w.label=1;case 1:w.trys.push([1,3,,4]),a=new URLSearchParams({api_key:this.localConfig.apiKey});try{for(u=V(this.configKeys),l=u.next();!l.done;l=u.next())c=l.value,a.append("config_keys",c)}catch(R){I={error:R}}finally{try{l&&!l.done&&(m=u.return)&&m.call(u)}finally{if(I)throw I.error}}return s&&a.set("session_id",String(s)),v={headers:{Accept:"*/*"},method:"GET"},d="".concat(this.getServerUrl(),"?").concat(a.toString()),this.attempts+=1,[4,fetch(d,T(T({},v),{signal:i}))];case 2:if(f=w.sent(),f===null)return[2,this.completeRequest({err:xt})];switch(h=new $n().buildStatus(f.status),h){case B.Success:return this.attempts=0,[2,this.parseAndStoreConfig(f)];case B.Failed:return[2,this.retryFetch(i,s)];default:return[2,this.completeRequest({err:Xn})]}case 3:return g=w.sent(),E=g,i.aborted?[2,this.completeRequest({err:Mt})]:[2,this.completeRequest({err:(b=E.message)!==null&&b!==void 0?b:xt})];case 4:return[2]}})})},this.retryFetch=function(i,s){return C(o,void 0,void 0,function(){var a=this;return _(this,function(u){switch(u.label){case 0:return[4,new Promise(function(l){return setTimeout(l,a.attempts*a.retryTimeout)})];case 1:return u.sent(),[2,this.fetchRemoteConfig(i,s)]}})})},this.parseAndStoreConfig=function(i){return C(o,void 0,void 0,function(){var s;return _(this,function(a){switch(a.label){case 0:return[4,i.json()];case 1:return s=a.sent(),this.completeRequest({success:Qn}),[2,s]}})})},this.localConfig=r,this.configKeys=n}return t.prototype.getServerUrl=function(){return this.localConfig.configServerUrl?this.localConfig.configServerUrl:this.localConfig.serverZone===Be.STAGING?Yn:this.localConfig.serverZone===Be.EU?Zn:Hn},t.prototype.completeRequest=function(e){var r=e.err,n=e.success;if(r)throw new Error(r);n&&this.localConfig.loggerProvider.log(n)},t}(),ei=function(t){var e=t.localConfig,r=t.configKeys;return C(void 0,void 0,void 0,function(){return _(this,function(n){return[2,new Jn({localConfig:e,configKeys:r})]})})},ti=ei,ri=function(t,e){var r=document.createDocumentFragment(),n=function(o){if(o===void 0&&(o=[]),typeof o=="string"&&(o=[o]),o=o.filter(function(i){try{r.querySelector(i)}catch{return e.warn('[session-replay-browser] omitting selector "'.concat(i,'" because it is invalid')),!1}return!0}),o.length!==0)return o};return t.blockSelector=n(t.blockSelector),t.maskSelector=n(t.maskSelector),t.unmaskSelector=n(t.unmaskSelector),t},ni=function(){function t(e,r){this.localConfig=r,this.remoteConfigFetch=e}return t.prototype.generateJoinedConfig=function(e){var r,n,o,i;return C(this,void 0,void 0,function(){var s,a,u,l,c,v,d,f,h,g,E,I,m,b,w,R,S,p,y,P,A;return _(this,function(M){switch(M.label){case 0:s=T({},this.localConfig),s.optOut=this.localConfig.optOut,s.captureEnabled=!0,M.label=1;case 1:return M.trys.push([1,3,,4]),[4,this.remoteConfigFetch.getRemoteNamespaceConfig("sessionReplay",e)];case 2:return u=M.sent(),u&&(l=u.sr_sampling_config,c=u.sr_privacy_config,v=(r=s.interactionConfig)===null||r===void 0?void 0:r.ugcFilterRules,s.interactionConfig=u.sr_interaction_config,s.interactionConfig&&v&&(s.interactionConfig.ugcFilterRules=v),s.loggingConfig=u.sr_logging_config,(l||c)&&(a={},l&&(a.sr_sampling_config=l),c&&(a.sr_privacy_config=c))),[3,4];case 3:return d=M.sent(),f=d,this.localConfig.loggerProvider.warn(f.message),s.captureEnabled=!1,[3,4];case 4:if(!a)return[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:a}];if(h=a.sr_sampling_config,g=a.sr_privacy_config,h&&Object.keys(h).length>0?(Object.prototype.hasOwnProperty.call(h,"capture_enabled")?s.captureEnabled=h.capture_enabled:s.captureEnabled=!1,Object.prototype.hasOwnProperty.call(h,"sample_rate")&&(s.sampleRate=h.sample_rate)):(s.captureEnabled=!0,this.localConfig.loggerProvider.debug("Remote config successfully fetched, but no values set for project, Session Replay capture enabled.")),g){E=(n=s.privacyConfig)!==null&&n!==void 0?n:{},I={defaultMaskLevel:(i=(o=g.defaultMaskLevel)!==null&&o!==void 0?o:E.defaultMaskLevel)!==null&&i!==void 0?i:"medium",blockSelector:[],maskSelector:[],unmaskSelector:[]},m=function(D){var Y,F,N,W,k,K,z,ue,G,Z={};typeof D.blockSelector=="string"&&(D.blockSelector=[D.blockSelector]);try{for(var H=V((z=D.blockSelector)!==null&&z!==void 0?z:[]),x=H.next();!x.done;x=H.next()){var O=x.value;Z[O]="block"}}catch(ne){Y={error:ne}}finally{try{x&&!x.done&&(F=H.return)&&F.call(H)}finally{if(Y)throw Y.error}}try{for(var ge=V((ue=D.maskSelector)!==null&&ue!==void 0?ue:[]),te=ge.next();!te.done;te=ge.next()){var O=te.value;Z[O]="mask"}}catch(ne){N={error:ne}}finally{try{te&&!te.done&&(W=ge.return)&&W.call(ge)}finally{if(N)throw N.error}}try{for(var re=V((G=D.unmaskSelector)!==null&&G!==void 0?G:[]),le=re.next();!le.done;le=re.next()){var O=le.value;Z[O]="unmask"}}catch(ne){k={error:ne}}finally{try{le&&!le.done&&(K=re.return)&&K.call(re)}finally{if(k)throw k.error}}return Z},b=T(T({},m(E)),m(g));try{for(w=V(Object.entries(b)),R=w.next();!R.done;R=w.next())S=J(R.value,2),p=S[0],y=S[1],y==="mask"?I.maskSelector.push(p):y==="block"?I.blockSelector.push(p):y==="unmask"&&I.unmaskSelector.push(p)}catch(D){P={error:D}}finally{try{R&&!R.done&&(A=w.return)&&A.call(w)}finally{if(P)throw P.error}}s.privacyConfig=ri(I,this.localConfig.loggerProvider)}return this.localConfig.loggerProvider.debug(JSON.stringify({name:"session replay joined config",config:vr(s)},null,2)),[2,{localConfig:this.localConfig,joinedConfig:s,remoteConfig:a}]}})})},t}(),ii=function(t,e){return C(void 0,void 0,void 0,function(){var r,n;return _(this,function(o){switch(o.label){case 0:return r=new Wn(t,e),[4,ti({localConfig:r,configKeys:["sessionReplay"]})];case 1:return n=o.sent(),[2,new ni(n,r)]}})})},oi="Unexpected error occurred",si="Network error occurred, event batch rejected",ai="Session replay event batch rejected due to exceeded retry count",ye="Failed to store session replay events in IndexedDB",ui="Session replay event batch not sent due to missing device ID",li="Session replay event batch not sent due to missing api key",it="1.27.0",ci=function(){function t(e){var r=e.trackServerUrl,n=e.loggerProvider,o=e.payloadBatcher;this.storageKey="",this.retryTimeout=1e3,this.scheduled=null,this.queue=[],this.loggerProvider=n,this.payloadBatcher=o||function(i){return i},this.trackServerUrl=r}return t.prototype.sendEventsList=function(e){this.addToQueue(T(T({},e),{attempts:0,timeout:0}))},t.prototype.addToQueue=function(){for(var e=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var o=r.filter(function(i){return i.attempts<(i.flushMaxRetries||0)?(i.attempts+=1,!0):(e.completeRequest({context:i,err:ai}),!1)});o.forEach(function(i){if(e.queue=e.queue.concat(i),i.timeout===0){e.schedule(0);return}setTimeout(function(){i.timeout=0,e.schedule(0)},i.timeout)})},t.prototype.schedule=function(e){var r=this;this.scheduled||(this.scheduled=setTimeout(function(){r.flush(!0).then(function(){r.queue.length>0&&r.schedule(e)})},e))},t.prototype.flush=function(e){return e===void 0&&(e=!1),C(this,void 0,void 0,function(){var r,n,o=this;return _(this,function(i){switch(i.label){case 0:return r=[],n=[],this.queue.forEach(function(s){return s.timeout===0?r.push(s):n.push(s)}),this.queue=n,this.scheduled&&(clearTimeout(this.scheduled),this.scheduled=null),[4,Promise.all(r.map(function(s){return o.send(s,e)}))];case 1:return i.sent(),[2]}})})},t.prototype.send=function(e,r){var n,o;return r===void 0&&(r=!0),C(this,void 0,void 0,function(){var i,s,a,u,l,c,v,d,f,h,g,E,I;return _(this,function(m){switch(m.label){case 0:if(i=e.apiKey,!i)return[2,this.completeRequest({context:e,err:li})];if(s=e.deviceId,!s)return[2,this.completeRequest({context:e,err:ui})];if(a=Nn(),u=it,l=e.sampleRate,c=new URLSearchParams({device_id:s,session_id:"".concat(e.sessionId),type:"".concat(e.type)}),v="".concat(((n=e.version)===null||n===void 0?void 0:n.type)||"standalone","/").concat(((o=e.version)===null||o===void 0?void 0:o.version)||u),d=this.payloadBatcher({version:1,events:e.events}),d.events.length===0)return this.completeRequest({context:e}),[2];m.label=1;case 1:return m.trys.push([1,3,,4]),f={headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer ".concat(i),"X-Client-Version":u,"X-Client-Library":v,"X-Client-Url":a.substring(0,On),"X-Client-Sample-Rate":"".concat(l)},body:JSON.stringify(d),method:"POST"},h="".concat(dr(e.serverZone,this.trackServerUrl),"?").concat(c.toString()),[4,fetch(h,f)];case 2:if(g=m.sent(),g===null)return this.completeRequest({context:e,err:oi}),[2];if(r)this.handleReponse(g.status,e);else{E="";try{E=JSON.stringify(g.body,null,2)}catch{}this.completeRequest({context:e,success:"".concat(g.status,": ").concat(E)})}return[3,4];case 3:return I=m.sent(),this.completeRequest({context:e,err:I}),[3,4];case 4:return[2]}})})},t.prototype.handleReponse=function(e,r){var n=new or().buildStatus(e);switch(n){case U.Success:this.handleSuccessResponse(r);break;case U.Failed:this.handleOtherResponse(r);break;default:this.completeRequest({context:r,err:si})}},t.prototype.handleSuccessResponse=function(e){var r=Math.round(new Blob(e.events).size/lr);this.completeRequest({context:e,success:"Session replay event batch tracked successfully for session id ".concat(e.sessionId,", size of events: ").concat(r," KB")})},t.prototype.handleOtherResponse=function(e){this.addToQueue(T(T({},e),{timeout:e.attempts*this.retryTimeout}))},t.prototype.completeRequest=function(e){var r=e.context,n=e.err,o=e.success;r.onComplete(),n?this.loggerProvider.warn(n):o&&this.loggerProvider.log(o)},t}();const ot=(t,e)=>e.some(r=>t instanceof r);let Ut,Bt;function di(){return Ut||(Ut=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fi(){return Bt||(Bt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const st=new WeakMap,$e=new WeakMap,Ge=new WeakMap;function vi(t){const e=new Promise((r,n)=>{const o=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{r(de(t.result)),o()},s=()=>{n(t.error),o()};t.addEventListener("success",i),t.addEventListener("error",s)});return Ge.set(e,t),e}function hi(t){if(st.has(t))return;const e=new Promise((r,n)=>{const o=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{r(),o()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});st.set(t,e)}let at={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return st.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return de(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function yr(t){at=t(at)}function gi(t){return fi().includes(t)?function(...e){return t.apply(ut(this),e),de(this.request)}:function(...e){return de(t.apply(ut(this),e))}}function pi(t){return typeof t=="function"?gi(t):(t instanceof IDBTransaction&&hi(t),ot(t,di())?new Proxy(t,at):t)}function de(t){if(t instanceof IDBRequest)return vi(t);if($e.has(t))return $e.get(t);const e=pi(t);return e!==t&&($e.set(t,e),Ge.set(e,t)),e}const ut=t=>Ge.get(t);function yi(t,e,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){const s=indexedDB.open(t,e),a=de(s);return n&&s.addEventListener("upgradeneeded",u=>{n(de(s.result),u.oldVersion,u.newVersion,de(s.transaction),u)}),r&&s.addEventListener("blocked",u=>r(u.oldVersion,u.newVersion,u)),a.then(u=>{i&&u.addEventListener("close",()=>i()),o&&u.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const mi=["get","getKey","getAll","getAllKeys","count"],Si=["put","add","delete","clear"],Xe=new Map;function Nt(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Xe.get(e))return Xe.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,o=Si.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||mi.includes(r)))return;const i=async function(s,...a){const u=this.transaction(s,o?"readwrite":"readonly");let l=u.store;return n&&(l=l.index(a.shift())),(await Promise.all([l[r](...a),o&&u.done]))[0]};return Xe.set(e,i),i}yr(t=>({...t,get:(e,r,n)=>Nt(e,r)||t.get(e,r,n),has:(e,r)=>!!Nt(e,r)||t.has(e,r)}));const Ei=["continue","continuePrimaryKey","advance"],qt={},lt=new WeakMap,mr=new WeakMap,bi={get(t,e){if(!Ei.includes(e))return t[e];let r=qt[e];return r||(r=qt[e]=function(...n){lt.set(this,mr.get(this)[e](...n))}),r}};async function*wi(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,bi);for(mr.set(r,e),Ge.set(r,ut(e));e;)yield r,e=await(lt.get(r)||e.continue()),lt.delete(r)}function Ft(t,e){return e===Symbol.asyncIterator&&ot(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&ot(t,[IDBIndex,IDBObjectStore])}yr(t=>({...t,get(e,r,n){return Ft(e,r)?wi:t.get(e,r,n)},has(e,r){return Ft(e,r)||t.has(e,r)}}));var Sr=function(){function t(e){var r=this,n,o,i;this.minInterval=Dn,this.maxInterval=kn,this.maxPersistedEventsSize=Tn,this.interval=this.minInterval,this._timeAtLastSplit=Date.now(),this.shouldSplitEventsList=function(s,a){var u=r.getStringSize(a),l=r.getEventsArraySize(s);return l+u>=r.maxPersistedEventsSize?!0:Date.now()-r.timeAtLastSplit>r.interval&&s.length?(r.interval=Math.min(r.maxInterval,r.interval+r.minInterval),r._timeAtLastSplit=Date.now(),!0):!1},this.loggerProvider=e.loggerProvider,this.minInterval=(n=e.minInterval)!==null&&n!==void 0?n:this.minInterval,this.maxInterval=(o=e.maxInterval)!==null&&o!==void 0?o:this.maxInterval,this.maxPersistedEventsSize=(i=e.maxPersistedEventsSize)!==null&&i!==void 0?i:this.maxPersistedEventsSize}return Object.defineProperty(t.prototype,"timeAtLastSplit",{get:function(){return this._timeAtLastSplit},enumerable:!1,configurable:!0}),t.prototype.getStringSize=function(e){return e.length},t.prototype.getEventsArraySize=function(e){var r,n,o=0;try{for(var i=V(e),s=i.next();!s.done;s=i.next()){var a=s.value;o+=this.getStringSize(a)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}var u=2+Math.max(0,e.length-1)+e.length*2;return o+u},t}(),Ne;(function(t){t.RECORDING="recording",t.SENT="sent"})(Ne||(Ne={}));var Ie="sessionCurrentSequence",Re="sequencesToSend",Ii=function(){var t=j();return new Promise(function(e,r){if(!t)return r(new Error("Global scope not found"));if(!t.indexedDB)return r(new Error("Session Replay: cannot find indexedDB"));try{var n=t.indexedDB.open("keyval-store");n.onupgradeneeded=function(){n.result.version===1&&(n.result.close(),n.transaction&&n.transaction.abort(),t.indexedDB.deleteDatabase("keyval-store"),e())},n.onsuccess=function(){e(n.result)},n.onerror=function(){r(n.error)}}catch(o){r(o)}})},Kt=function(t){return C(void 0,void 0,void 0,function(){var e,r;return _(this,function(n){switch(n.label){case 0:return t.length>0?(e=10,r=t.splice(0,e),[4,Promise.all(r)]):[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}})})},Ri=function(t){var e,r;return t.objectStoreNames.contains(Ie)||(r=t.createObjectStore(Ie,{keyPath:"sessionId"})),t.objectStoreNames.contains(Re)||(e=t.createObjectStore(Re,{keyPath:"sequenceId",autoIncrement:!0}),e.createIndex("sessionId","sessionId")),{sequencesStore:e,currentSequenceStore:r}},_i=function(t){return C(void 0,void 0,void 0,function(){return _(this,function(e){switch(e.label){case 0:return[4,yi(t,1,{upgrade:Ri})];case 1:return[2,e.sent()]}})})},Ci=function(t){Fe(e,t);function e(r){var n=t.call(this,r)||this;return n.getSequencesToSend=function(){return C(n,void 0,void 0,function(){var o,i,s,a,u,l;return _(this,function(c){switch(c.label){case 0:return c.trys.push([0,5,,6]),o=[],[4,this.db.transaction("sequencesToSend").store.openCursor()];case 1:i=c.sent(),c.label=2;case 2:return i?(s=i.value,a=s.sessionId,u=s.events,o.push({events:u,sequenceId:i.key,sessionId:a}),[4,i.continue()]):[3,4];case 3:return i=c.sent(),[3,2];case 4:return[2,o];case 5:return l=c.sent(),this.loggerProvider.warn("".concat(ye,": ").concat(l)),[3,6];case 6:return[2,void 0]}})})},n.storeCurrentSequence=function(o){return C(n,void 0,void 0,function(){var i,s,a;return _(this,function(u){switch(u.label){case 0:return u.trys.push([0,4,,5]),[4,this.db.get(Ie,o)];case 1:return i=u.sent(),i?[4,this.db.put(Re,{sessionId:o,events:i.events})]:[2,void 0];case 2:return s=u.sent(),[4,this.db.put(Ie,{sessionId:o,events:[]})];case 3:return u.sent(),[2,T(T({},i),{sessionId:o,sequenceId:s})];case 4:return a=u.sent(),this.loggerProvider.warn("".concat(ye,": ").concat(a)),[3,5];case 5:return[2,void 0]}})})},n.addEventToCurrentSequence=function(o,i){return C(n,void 0,void 0,function(){var s,a,u,l,c,v;return _(this,function(d){switch(d.label){case 0:return d.trys.push([0,10,,11]),s=this.db.transaction(Ie,"readwrite"),[4,s.store.get(o)];case 1:return a=d.sent(),a?[3,3]:[4,s.store.put({sessionId:o,events:[i]})];case 2:return d.sent(),[2];case 3:return u=void 0,this.shouldSplitEventsList(a.events,i)?(u=a.events,[4,s.store.put({sessionId:o,events:[i]})]):[3,5];case 4:return d.sent(),[3,7];case 5:return l=a.events.concat(i),[4,s.store.put({sessionId:o,events:l})];case 6:d.sent(),d.label=7;case 7:return[4,s.done];case 8:return d.sent(),u?[4,this.storeSendingEvents(o,u)]:[2,void 0];case 9:return c=d.sent(),c?[2,{events:u,sessionId:o,sequenceId:c}]:[2,void 0];case 10:return v=d.sent(),this.loggerProvider.warn("".concat(ye,": ").concat(v)),[3,11];case 11:return[2,void 0]}})})},n.storeSendingEvents=function(o,i){return C(n,void 0,void 0,function(){var s,a;return _(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,this.db.put(Re,{sessionId:o,events:i})];case 1:return s=u.sent(),[2,s];case 2:return a=u.sent(),this.loggerProvider.warn("".concat(ye,": ").concat(a)),[3,3];case 3:return[2,void 0]}})})},n.cleanUpSessionEventsStore=function(o,i){return C(n,void 0,void 0,function(){var s;return _(this,function(a){switch(a.label){case 0:if(!i)return[2];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.db.delete(Re,i)];case 2:return a.sent(),[3,4];case 3:return s=a.sent(),this.loggerProvider.warn("".concat(ye,": ").concat(s)),[3,4];case 4:return[2]}})})},n.transitionFromKeyValStore=function(o){return C(n,void 0,void 0,function(){var i,s,a,u,l,c,v,d,f=this;return _(this,function(h){switch(h.label){case 0:return h.trys.push([0,6,,7]),[4,Ii()];case 1:if(i=h.sent(),!i)return[2];s=function(g,E){return C(f,void 0,void 0,function(){var I,m,b=this;return _(this,function(w){switch(w.label){case 0:return I=E.sessionSequences,m=[],Object.keys(I).forEach(function(R){var S=parseInt(R,10),p=I[S];if(S===E.currentSequenceId){var y=p.events.map(function(P){return C(b,void 0,void 0,function(){return _(this,function(A){return[2,this.addEventToCurrentSequence(g,P)]})})});m.push.apply(m,ve([],J(y),!1))}else p.status!==Ne.SENT&&m.push(b.storeSendingEvents(g,p.events))}),[4,Kt(m)];case 1:return w.sent(),[2]}})})},a="".concat(Jr,"_").concat(this.apiKey.substring(0,10)),h.label=2;case 2:return h.trys.push([2,4,,5]),u=i.transaction("keyval").objectStore("keyval").getAll(a),l=new Promise(function(g){u.onsuccess=function(E){return C(f,void 0,void 0,function(){var I,m,b,w=this;return _(this,function(R){switch(R.label){case 0:return I=E&&E.target.result,m=I&&I[0],m?(b=[],Object.keys(m).forEach(function(S){var p=parseInt(S,10),y=m[p];if(o===p)b.push(s(p,y));else{var P=y.sessionSequences;Object.keys(P).forEach(function(A){var M=parseInt(A,10);P[M].status!==Ne.SENT&&b.push(w.storeSendingEvents(p,P[M].events))})}}),[4,Kt(b)]):[3,2];case 1:R.sent(),R.label=2;case 2:return g(),[2]}})})}}),[4,l];case 3:return h.sent(),c=j(),c&&c.indexedDB.deleteDatabase("keyval-store"),[3,5];case 4:return v=h.sent(),this.loggerProvider.warn("Failed to transition session replay events from keyval to new store: ".concat(v)),[3,5];case 5:return[3,7];case 6:return d=h.sent(),this.loggerProvider.warn("Failed to access keyval store: ".concat(d,". For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices")),[3,7];case 7:return[2]}})})},n.apiKey=r.apiKey,n.db=r.db,n}return e.new=function(r,n,o){return C(this,void 0,void 0,function(){var i,s,a,u,l;return _(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),i=r==="replay"?"":"_".concat(r),s="".concat(n.apiKey.substring(0,10),"_amp_session_replay_events").concat(i),[4,_i(s)];case 1:return a=c.sent(),u=new e(T(T({},n),{db:a})),[4,u.transitionFromKeyValStore(o)];case 2:return c.sent(),[2,u];case 3:return l=c.sent(),n.loggerProvider.warn("".concat(ye,": ").concat(l)),[3,4];case 4:return[2]}})})},e.prototype.getCurrentSequenceEvents=function(r){return C(this,void 0,void 0,function(){var s,n,o,i,s,a,u,l;return _(this,function(c){switch(c.label){case 0:return r?[4,this.db.get("sessionCurrentSequence",r)]:[3,2];case 1:return s=c.sent(),s?[2,[s]]:[2,void 0];case 2:n=[],c.label=3;case 3:return c.trys.push([3,8,9,10]),[4,this.db.getAll("sessionCurrentSequence")];case 4:o=V.apply(void 0,[c.sent()]),i=o.next(),c.label=5;case 5:if(i.done)return[3,7];s=i.value,n.push(s),c.label=6;case 6:return i=o.next(),[3,5];case 7:return[3,10];case 8:return a=c.sent(),u={error:a},[3,10];case 9:try{i&&!i.done&&(l=o.return)&&l.call(o)}finally{if(u)throw u.error}return[7];case 10:return[2,n]}})})},e}(Sr),Pi=function(t){Fe(e,t);function e(){var r=t!==null&&t.apply(this,arguments)||this;return r.finalizedSequences={},r.sequences={},r.sequenceId=0,r}return e.prototype.resetCurrentSequence=function(r){this.sequences[r]=[]},e.prototype.addSequence=function(r){var n=this.sequenceId++,o=ve([],J(this.sequences[r]),!1);return this.finalizedSequences[n]={sessionId:r,events:o},this.resetCurrentSequence(r),{sequenceId:n,events:o,sessionId:r}},e.prototype.getSequencesToSend=function(){return C(this,void 0,void 0,function(){return _(this,function(r){return[2,Object.entries(this.finalizedSequences).map(function(n){var o=J(n,2),i=o[0],s=o[1],a=s.sessionId,u=s.events;return{sequenceId:Number(i),sessionId:a,events:u}})]})})},e.prototype.storeCurrentSequence=function(r){return C(this,void 0,void 0,function(){return _(this,function(n){return this.sequences[r]?[2,this.addSequence(r)]:[2,void 0]})})},e.prototype.addEventToCurrentSequence=function(r,n){return C(this,void 0,void 0,function(){var o;return _(this,function(i){return this.sequences[r]||this.resetCurrentSequence(r),this.shouldSplitEventsList(this.sequences[r],n)&&(o=this.addSequence(r)),this.sequences[r].push(n),[2,o]})})},e.prototype.storeSendingEvents=function(r,n){return C(this,void 0,void 0,function(){return _(this,function(o){return this.finalizedSequences[this.sequenceId]={sessionId:r,events:n},[2,this.sequenceId++]})})},e.prototype.cleanUpSessionEventsStore=function(r,n){return C(this,void 0,void 0,function(){return _(this,function(o){return n!==void 0&&delete this.finalizedSequences[n],[2]})})},e}(Sr),Gt=function(t){var e=t.config,r=t.sessionId,n=t.minInterval,o=t.maxInterval,i=t.type,s=t.payloadBatcher,a=t.storeType;return C(void 0,void 0,void 0,function(){function u(m){return m===void 0&&(m=!1),C(this,void 0,void 0,function(){return _(this,function(b){return[2,l.flush(m)]})})}var l,c,v,d,f,h,g,E,I;return _(this,function(m){switch(m.label){case 0:return l=new ci(T(T({},e),{loggerProvider:e.loggerProvider,payloadBatcher:s})),c=function(){return new Pi({loggerProvider:e.loggerProvider,maxInterval:o,minInterval:n})},v=function(){return C(void 0,void 0,void 0,function(){var b;return _(this,function(w){switch(w.label){case 0:return[4,Ci.new(i,{loggerProvider:e.loggerProvider,minInterval:n,maxInterval:o,apiKey:e.apiKey},r)];case 1:return b=w.sent(),e.loggerProvider.log("Failed to initialize idb store, falling back to memory store."),[2,b??c()]}})})},a!=="idb"?[3,2]:[4,v()];case 1:return f=m.sent(),[3,3];case 2:f=c(),m.label=3;case 3:return d=f,h=function(b){var w=b.events,R=b.sessionId,S=b.deviceId,p=b.sequenceId;e.debugMode&&fr().then(function(y){var P=y.totalStorageSize,A=y.percentOfQuota,M=y.usageDetails;e.loggerProvider.debug("Total storage size: ".concat(P," KB, percentage of quota: ").concat(A,"%, usage details: ").concat(M))}).catch(function(){}),l.sendEventsList({events:w,sessionId:R,flushMaxRetries:e.flushMaxRetries,apiKey:e.apiKey,deviceId:S,sampleRate:e.sampleRate,serverZone:e.serverZone,version:e.version,type:i,onComplete:function(){return C(void 0,void 0,void 0,function(){return _(this,function(y){switch(y.label){case 0:return[4,d.cleanUpSessionEventsStore(R,p)];case 1:return y.sent(),[2]}})})}})},g=function(b){var w=b.sessionId,R=b.deviceId;d.storeCurrentSequence(w).then(function(S){S&&h({sequenceId:S.sequenceId,events:S.events,sessionId:S.sessionId,deviceId:R})}).catch(function(S){e.loggerProvider.warn("Failed to get current sequence of session replay events for session:",S)})},E=function(b){var w=b.deviceId;return C(void 0,void 0,void 0,function(){var R;return _(this,function(S){switch(S.label){case 0:return[4,d.getSequencesToSend()];case 1:return R=S.sent(),R&&R.forEach(function(p){h({sequenceId:p.sequenceId,events:p.events,sessionId:p.sessionId,deviceId:w})}),[2]}})})},I=function(b){var w=b.event,R=b.sessionId,S=b.deviceId;d.addEventToCurrentSequence(R,w.data).then(function(p){return p&&h({sequenceId:p.sequenceId,events:p.events,sessionId:p.sessionId,deviceId:S})}).catch(function(p){e.loggerProvider.warn("Failed to add event to session replay capture:",p)})},[2,{sendCurrentSequenceEvents:g,addEvent:I,sendStoredEvents:E,flush:u}]}})})},Wt=function(){function t(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n=new Map;e.forEach(function(o){n.set(o.name,o.manager)}),this.managers=n}return t.prototype.sendStoredEvents=function(e){return C(this,void 0,void 0,function(){var r;return _(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(o){r.push(o.sendStoredEvents(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t.prototype.addEvent=function(e){var r,n=e.sessionId,o=e.event,i=e.deviceId;(r=this.managers.get(o.type))===null||r===void 0||r.addEvent({sessionId:n,event:o,deviceId:i})},t.prototype.sendCurrentSequenceEvents=function(e){var r=e.sessionId,n=e.deviceId;this.managers.forEach(function(o){o.sendCurrentSequenceEvents({sessionId:r,deviceId:n})})},t.prototype.flush=function(e){return C(this,void 0,void 0,function(){var r;return _(this,function(n){switch(n.label){case 0:return r=[],this.managers.forEach(function(o){r.push(o.flush(e))}),[4,Promise.all(r)];case 1:return n.sent(),[2]}})})},t}();const Vt={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},zt={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},Le={};function Ti(t){var e,r;const n=(r=(e=globalThis?.Zone)==null?void 0:e.__symbol__)==null?void 0:r.call(e,t);if(n&&globalThis[n])return globalThis[n]}function yt(t){if(Le[t])return Le[t];const e=Ti(t)||globalThis[t],r=e.prototype,n=t in Vt?Vt[t]:void 0,o=!!(n&&n.every(a=>{var u,l;return!!((l=(u=Object.getOwnPropertyDescriptor(r,a))==null?void 0:u.get)!=null&&l.toString().includes("[native code]"))})),i=t in zt?zt[t]:void 0,s=!!(i&&i.every(a=>{var u;return typeof r[a]=="function"&&((u=r[a])==null?void 0:u.toString().includes("[native code]"))}));if(o&&s)return Le[t]=e.prototype,e.prototype;try{const a=document.createElement("iframe");document.body.appendChild(a);const u=a.contentWindow;if(!u)return e.prototype;const l=u[t].prototype;return document.body.removeChild(a),l?Le[t]=l:r}catch{return r}}const Qe={};function ae(t,e,r){var n;const o=`${t}.${String(r)}`;if(Qe[o])return Qe[o].call(e);const i=yt(t),s=(n=Object.getOwnPropertyDescriptor(i,r))==null?void 0:n.get;return s?(Qe[o]=s,s.call(e)):e[r]}const je={};function Er(t,e,r){const n=`${t}.${String(r)}`;if(je[n])return je[n].bind(e);const i=yt(t)[r];return typeof i!="function"?e[r]:(je[n]=i,i.bind(e))}function Li(t){return ae("Node",t,"childNodes")}function Ai(t){return ae("Node",t,"parentNode")}function Di(t){return ae("Node",t,"parentElement")}function ki(t){return ae("Node",t,"textContent")}function Oi(t,e){return Er("Node",t,"contains")(e)}function Mi(t){return Er("Node",t,"getRootNode")()}function xi(t){return!t||!("host"in t)?null:ae("ShadowRoot",t,"host")}function Ui(t){return t.styleSheets}function Bi(t){return!t||!("shadowRoot"in t)?null:ae("Element",t,"shadowRoot")}function Ni(t,e){return ae("Element",t,"querySelector")(e)}function qi(t,e){return ae("Element",t,"querySelectorAll")(e)}function Fi(){return yt("MutationObserver").constructor}const $t={childNodes:Li,parentNode:Ai,parentElement:Di,textContent:ki,contains:Oi,getRootNode:Mi,host:xi,styleSheets:Ui,shadowRoot:Bi,querySelector:Ni,querySelectorAll:qi,mutationObserver:Fi};function Ki(t){var e,r,n,o,i=t.document;return{left:i.scrollingElement?i.scrollingElement.scrollLeft:t.pageXOffset!==void 0?t.pageXOffset:i.documentElement.scrollLeft||i?.body&&((e=$t.parentElement(i.body))===null||e===void 0?void 0:e.scrollLeft)||((r=i?.body)===null||r===void 0?void 0:r.scrollLeft)||0,top:i.scrollingElement?i.scrollingElement.scrollTop:t.pageYOffset!==void 0?t.pageYOffset:i?.documentElement.scrollTop||i?.body&&((n=$t.parentElement(i.body))===null||n===void 0?void 0:n.scrollTop)||((o=i?.body)===null||o===void 0?void 0:o.scrollTop)||0}}function He(){var t=j();return t?.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function Ye(){var t=j();return t?.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}var X,mt,br;function Gi(t,e){if(br=new Date,t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if(t.tagName.toLowerCase()==="html")return"html";var r={root:document.body,idName:function(i){return!0},className:function(i){return!0},tagName:function(i){return!0},attr:function(i,s){return!1},seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};X=T(T({},r),e),mt=Wi(X.root,r);var n=Ae(t,"all",function(){return Ae(t,"two",function(){return Ae(t,"one",function(){return Ae(t,"none")})})});if(n){var o=Rr(_r(n,t));return o.length>0&&(n=o[0]),We(n)}else throw new Error("Selector was not found.")}function Wi(t,e){return t.nodeType===Node.DOCUMENT_NODE?t:t===e.root?t.ownerDocument:t}function Ae(t,e,r){for(var n=null,o=[],i=t,s=0,a=function(){var l,c,v=new Date().getTime()-br.getTime();if(X.timeoutMs!==void 0&&v>X.timeoutMs)throw new Error("Timeout: Can't find a unique selector after ".concat(v,"ms"));var d=ke(Vi(i))||ke.apply(void 0,ve([],J(zi(i)),!1))||ke.apply(void 0,ve([],J($i(i)),!1))||ke(Xi(i))||[jt()],f=Qi(i);if(e=="all")f&&(d=d.concat(d.filter(Ze).map(function(m){return De(m,f)})));else if(e=="two")d=d.slice(0,1),f&&(d=d.concat(d.filter(Ze).map(function(m){return De(m,f)})));else if(e=="one"){var h=J(d=d.slice(0,1),1),g=h[0];f&&Ze(g)&&(d=[De(g,f)])}else e=="none"&&(d=[jt()],f&&(d=[De(d[0],f)]));try{for(var E=(l=void 0,V(d)),I=E.next();!I.done;I=E.next()){var g=I.value;g.level=s}}catch(m){l={error:m}}finally{try{I&&!I.done&&(c=E.return)&&c.call(E)}finally{if(l)throw l.error}}if(o.push(d),o.length>=X.seedMinLength&&(n=Xt(o,r),n))return"break";i=i.parentElement,s++};i;){var u=a();if(u==="break")break}return n||(n=Xt(o,r)),!n&&r?r():n}function Xt(t,e){var r,n,o=Rr(Ir(t));if(o.length>X.threshold)return e?e():null;try{for(var i=V(o),s=i.next();!s.done;s=i.next()){var a=s.value;if(wr(a))return a}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return null}function We(t){for(var e=t[0],r=e.name,n=1;n<t.length;n++){var o=t[n].level||0;e.level===o-1?r="".concat(t[n].name," > ").concat(r):r="".concat(t[n].name," ").concat(r),e=t[n]}return r}function Qt(t){return t.map(function(e){return e.penalty}).reduce(function(e,r){return e+r},0)}function wr(t){var e=We(t);switch(mt.querySelectorAll(e).length){case 0:throw new Error("Can't select any node with this selector: ".concat(e));case 1:return!0;default:return!1}}function Vi(t){var e=t.getAttribute("id");return e&&X.idName(e)?{name:"#"+CSS.escape(e),penalty:0}:null}function zi(t){var e=Array.from(t.attributes).filter(function(r){return X.attr(r.name,r.value)});return e.map(function(r){return{name:"[".concat(CSS.escape(r.name),'="').concat(CSS.escape(r.value),'"]'),penalty:.5}})}function $i(t){var e=Array.from(t.classList).filter(X.className);return e.map(function(r){return{name:"."+CSS.escape(r),penalty:1}})}function Xi(t){var e=t.tagName.toLowerCase();return X.tagName(e)?{name:e,penalty:2}:null}function jt(){return{name:"*",penalty:3}}function Qi(t){var e=t.parentNode;if(!e)return null;var r=e.firstChild;if(!r)return null;for(var n=0;r&&(r.nodeType===Node.ELEMENT_NODE&&n++,r!==t);)r=r.nextSibling;return n}function De(t,e){return{name:t.name+":nth-child(".concat(e,")"),penalty:t.penalty+1}}function Ze(t){return t.name!=="html"&&!t.name.startsWith("#")}function ke(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=t.filter(ji);return r.length>0?r:null}function ji(t){return t!=null}function Ir(t,e){var r,n,o,i,s,a;return e===void 0&&(e=[]),_(this,function(u){switch(u.label){case 0:if(!(t.length>0))return[3,9];u.label=1;case 1:u.trys.push([1,6,7,8]),r=V(t[0]),n=r.next(),u.label=2;case 2:return n.done?[3,5]:(o=n.value,[5,V(Ir(t.slice(1,t.length),e.concat(o)))]);case 3:u.sent(),u.label=4;case 4:return n=r.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),s={error:i},[3,8];case 7:try{n&&!n.done&&(a=r.return)&&a.call(r)}finally{if(s)throw s.error}return[7];case 8:return[3,11];case 9:return[4,e];case 10:u.sent(),u.label=11;case 11:return[2]}})}function Rr(t){return ve([],J(t),!1).sort(function(e,r){return Qt(e)-Qt(r)})}function _r(t,e,r){var n,o,i;return r===void 0&&(r={counter:0,visited:new Map}),_(this,function(s){switch(s.label){case 0:if(!(t.length>2&&t.length>X.optimizedMinLength))return[3,5];n=1,s.label=1;case 1:return n<t.length-1?r.counter>X.maxNumberOfTries?[2]:(r.counter+=1,o=ve([],J(t),!1),o.splice(n,1),i=We(o),r.visited.has(i)?[2]:wr(o)&&Hi(o,e)?[4,o]:[3,4]):[3,5];case 2:return s.sent(),r.visited.set(i,!0),[5,V(_r(o,e,r))];case 3:s.sent(),s.label=4;case 4:return n++,[3,1];case 5:return[2]}})}function Hi(t,e){return mt.querySelector(We(t))===e}var Yi=36e5,Zi=function(t){var e=t.version,r=t.events,n=[];return r.forEach(function(o){var i=JSON.parse(o);i.count=1,i.type==="click"&&n.push(i)}),{version:e,events:n}},Ji=function(t){var e=t.version,r=t.events,n=[];r.forEach(function(i){var s=JSON.parse(i);s.type==="click"&&n.push(s)});var o=n.reduce(function(i,s){var a=s.x,u=s.y,l=s.selector,c=s.timestamp,v=c-c%Yi,d="".concat(a,":").concat(u,":").concat(l??"",":").concat(v);return i[d]?i[d].count+=1:i[d]=T(T({},s),{timestamp:v,count:1}),i},{});return{version:e,events:Object.values(o)}},eo=function(t,e){var r=e.eventsManager,n=e.sessionId,o=e.deviceIdFn,i=e.mirror,s=e.ugcFilterRules;return function(a){if(a.type===pr.Click){var u=j();if(u){var l=u.location,c=u.innerHeight,v=u.innerWidth;if(l){var d=a.x,f=a.y;if(!(d===void 0||f===void 0)){var h=i.getNode(a.id),g;if(h)try{g=Gi(h)}catch{t.debug("error resolving selector from finder")}var E=Ki(u),I=E.left,m=E.top,b=Ke(l.href,s),w={x:d+I,y:f+m,selector:g,viewportHeight:c,viewportWidth:v,pageUrl:b,timestamp:Date.now(),type:"click"},R=o();R&&r.addEvent({sessionId:n,event:{type:"interaction",data:JSON.stringify(w)},deviceId:R})}}}}}},to=function(){function t(e,r){var n=j();n&&n.navigator&&typeof n.navigator.sendBeacon=="function"?this.sendBeacon=function(o,i){try{if(n.navigator.sendBeacon(o,JSON.stringify(i)))return!0}catch{}return!1}:this.sendBeacon=function(){return!1},this.sendXhr=function(o,i){var s=new XMLHttpRequest;return s.open("POST",o,!0),s.setRequestHeader("Accept","*/*"),s.send(JSON.stringify(i)),!0},this.basePageUrl=dr(r.serverZone,r.trackServerUrl),this.apiKey=r.apiKey,this.context=e}return t.prototype.send=function(e,r){var n=this.context,o=n.sessionId,i=n.type,s=new URLSearchParams({device_id:e,session_id:String(o),type:String(i),api_key:this.apiKey}),a="".concat(this.basePageUrl,"?").concat(s.toString());this.sendBeacon(a,r)||this.sendXhr(a,r)},t}(),ro=function(){function t(e,r){var n=this;this.timestamp=Date.now(),this.hook=function(o){n.update(o)},this.send=function(o){return function(i){var s,a,u=o(),l=j();l&&u&&n.transport.send(u,{version:1,events:[{maxScrollX:n._maxScrollX,maxScrollY:n._maxScrollY,maxScrollWidth:n._maxScrollWidth,maxScrollHeight:n._maxScrollHeight,viewportHeight:He(),viewportWidth:Ye(),pageUrl:Ke(l.location.href,(a=(s=n.config.interactionConfig)===null||s===void 0?void 0:s.ugcFilterRules)!==null&&a!==void 0?a:[]),timestamp:n.timestamp,type:"scroll"}]})}},this._maxScrollX=0,this._maxScrollY=0,this._maxScrollWidth=Ye(),this._maxScrollHeight=He(),this.config=r,this.transport=e}return t.default=function(e,r){return new t(new to(e,r),r)},Object.defineProperty(t.prototype,"maxScrollX",{get:function(){return this._maxScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollY",{get:function(){return this._maxScrollY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollWidth",{get:function(){return this._maxScrollWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollHeight",{get:function(){return this._maxScrollHeight},enumerable:!1,configurable:!0}),t.prototype.update=function(e){var r=Date.now();if(e.x>this._maxScrollX){var n=Ye();this._maxScrollX=e.x;var o=e.x+n;o>this._maxScrollWidth&&(this._maxScrollWidth=o),this.timestamp=r}if(e.y>this._maxScrollY){var i=He();this._maxScrollY=e.y;var s=e.y+i;s>this._maxScrollHeight&&(this._maxScrollHeight=s),this.timestamp=r}},t}(),Ht=function(){function t(e){var r=e.sessionId,n=e.deviceId;this.deviceId=n,this.sessionId=r,r&&n&&(this.sessionReplayId=qn(r,n))}return t}(),Q=Uint8Array,q=Uint16Array,Pe=Uint32Array,St=new Q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Et=new Q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Yt=new Q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cr=function(t,e){for(var r=new q(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var o=new Pe(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return[r,o]},Pr=Cr(St,2),no=Pr[0],ct=Pr[1];no[28]=258,ct[258]=28;for(var io=Cr(Et,0),Zt=io[1],dt=new q(32768),L=0;L<32768;++L){var ie=(L&43690)>>>1|(L&21845)<<1;ie=(ie&52428)>>>2|(ie&13107)<<2,ie=(ie&61680)>>>4|(ie&3855)<<4,dt[L]=((ie&65280)>>>8|(ie&255)<<8)>>>1}for(var _e=function(t,e,r){for(var n=t.length,o=0,i=new q(e);o<n;++o)++i[t[o]-1];var s=new q(e);for(o=0;o<e;++o)s[o]=s[o-1]+i[o-1]<<1;var a;if(r){a=new q(1<<e);var u=15-e;for(o=0;o<n;++o)if(t[o])for(var l=o<<4|t[o],c=e-t[o],v=s[t[o]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)a[dt[v]>>>u]=l}else for(a=new q(n),o=0;o<n;++o)a[o]=dt[s[t[o]-1]++]>>>15-t[o];return a},he=new Q(288),L=0;L<144;++L)he[L]=8;for(var L=144;L<256;++L)he[L]=9;for(var L=256;L<280;++L)he[L]=7;for(var L=280;L<288;++L)he[L]=8;for(var qe=new Q(32),L=0;L<32;++L)qe[L]=5;var oo=_e(he,9,0),so=_e(qe,5,0),Tr=function(t){return(t/8>>0)+(t&7&&1)},Lr=function(t,e,r){(r==null||r>t.length)&&(r=t.length);var n=new(t instanceof q?q:t instanceof Pe?Pe:Q)(r-e);return n.set(t.subarray(e,r)),n},ee=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8},Ee=function(t,e,r){r<<=e&7;var n=e/8>>0;t[n]|=r,t[n+1]|=r>>>8,t[n+2]|=r>>>16},Je=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var o=r.length,i=r.slice();if(!o)return[new Q(0),0];if(o==1){var s=new Q(r[0].s+1);return s[r[0].s]=1,[s,1]}r.sort(function(R,S){return R.f-S.f}),r.push({s:-1,f:25001});var a=r[0],u=r[1],l=0,c=1,v=2;for(r[0]={s:-1,f:a.f+u.f,l:a,r:u};c!=o-1;)a=r[r[l].f<r[v].f?l++:v++],u=r[l!=c&&r[l].f<r[v].f?l++:v++],r[c++]={s:-1,f:a.f+u.f,l:a,r:u};for(var d=i[0].s,n=1;n<o;++n)i[n].s>d&&(d=i[n].s);var f=new q(d+1),h=ft(r[c-1],f,0);if(h>e){var n=0,g=0,E=h-e,I=1<<E;for(i.sort(function(S,p){return f[p.s]-f[S.s]||S.f-p.f});n<o;++n){var m=i[n].s;if(f[m]>e)g+=I-(1<<h-f[m]),f[m]=e;else break}for(g>>>=E;g>0;){var b=i[n].s;f[b]<e?g-=1<<e-f[b]++-1:++n}for(;n>=0&&g;--n){var w=i[n].s;f[w]==e&&(--f[w],++g)}h=e}return[new Q(f),h]},ft=function(t,e,r){return t.s==-1?Math.max(ft(t.l,e,r+1),ft(t.r,e,r+1)):e[t.s]=r},Jt=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new q(++e),n=0,o=t[0],i=1,s=function(u){r[n++]=u},a=1;a<=e;++a)if(t[a]==o&&a!=e)++i;else{if(!o&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(o),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(o);i=1,o=t[a]}return[r.subarray(0,n),e]},be=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},vt=function(t,e,r){var n=r.length,o=Tr(e+2);t[o]=n&255,t[o+1]=n>>>8,t[o+2]=t[o]^255,t[o+3]=t[o+1]^255;for(var i=0;i<n;++i)t[o+i+4]=r[i];return(o+4+n)*8},er=function(t,e,r,n,o,i,s,a,u,l,c){ee(e,c++,r),++o[256];for(var v=Je(o,15),d=v[0],f=v[1],h=Je(i,15),g=h[0],E=h[1],I=Jt(d),m=I[0],b=I[1],w=Jt(g),R=w[0],S=w[1],p=new q(19),y=0;y<m.length;++y)p[m[y]&31]++;for(var y=0;y<R.length;++y)p[R[y]&31]++;for(var P=Je(p,7),A=P[0],M=P[1],D=19;D>4&&!A[Yt[D-1]];--D);var Y=l+5<<3,F=be(o,he)+be(i,qe)+s,N=be(o,d)+be(i,g)+s+14+3*D+be(p,A)+(2*p[16]+3*p[17]+7*p[18]);if(Y<=F&&Y<=N)return vt(e,c,t.subarray(u,u+l));var W,k,K,z;if(ee(e,c,1+(N<F)),c+=2,N<F){W=_e(d,f,0),k=d,K=_e(g,E,0),z=g;var ue=_e(A,M,0);ee(e,c,b-257),ee(e,c+5,S-1),ee(e,c+10,D-4),c+=14;for(var y=0;y<D;++y)ee(e,c+3*y,A[Yt[y]]);c+=3*D;for(var G=[m,R],Z=0;Z<2;++Z)for(var H=G[Z],y=0;y<H.length;++y){var x=H[y]&31;ee(e,c,ue[x]),c+=A[x],x>15&&(ee(e,c,H[y]>>>5&127),c+=H[y]>>>12)}}else W=oo,k=he,K=so,z=qe;for(var y=0;y<a;++y)if(n[y]>255){var x=n[y]>>>18&31;Ee(e,c,W[x+257]),c+=k[x+257],x>7&&(ee(e,c,n[y]>>>23&31),c+=St[x]);var O=n[y]&31;Ee(e,c,K[O]),c+=z[O],O>3&&(Ee(e,c,n[y]>>>5&8191),c+=Et[O])}else Ee(e,c,W[n[y]]),c+=k[n[y]];return Ee(e,c,W[256]),c+k[256]},ao=new Pe([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),uo=function(t,e,r,n,o,i){var s=t.length,a=new Q(n+s+5*(1+Math.floor(s/7e3))+o),u=a.subarray(n,a.length-o),l=0;if(!e||s<8)for(var c=0;c<=s;c+=65535){var v=c+65535;v<s?l=vt(u,l,t.subarray(c,v)):(u[c]=i,l=vt(u,l,t.subarray(c,s)))}else{for(var d=ao[e-1],f=d>>>13,h=d&8191,g=(1<<r)-1,E=new q(32768),I=new q(g+1),m=Math.ceil(r/3),b=2*m,w=function(Ve){return(t[Ve]^t[Ve+1]<<m^t[Ve+2]<<b)&g},R=new Pe(25e3),S=new q(288),p=new q(32),y=0,P=0,c=0,A=0,M=0,D=0;c<s;++c){var Y=w(c),F=c&32767,N=I[Y];if(E[F]=N,I[Y]=F,M<=c){var W=s-c;if((y>7e3||A>24576)&&W>423){l=er(t,u,0,R,S,p,P,A,D,c-D,l),A=y=P=0,D=c;for(var k=0;k<286;++k)S[k]=0;for(var k=0;k<30;++k)p[k]=0}var K=2,z=0,ue=h,G=F-N&32767;if(W>2&&Y==w(c-G))for(var Z=Math.min(f,W)-1,H=Math.min(32767,c),x=Math.min(258,W);G<=H&&--ue&&F!=N;){if(t[c+K]==t[c+K-G]){for(var O=0;O<x&&t[c+O]==t[c+O-G];++O);if(O>K){if(K=O,z=G,O>Z)break;for(var ge=Math.min(G,O-2),te=0,k=0;k<ge;++k){var re=c-G+k+32768&32767,le=E[re],ne=re-le+32768&32767;ne>te&&(te=ne,N=re)}}}F=N,N=E[F],G+=F-N+32768&32767}if(z){R[A++]=268435456|ct[K]<<18|Zt[z];var bt=ct[K]&31,wt=Zt[z]&31;P+=St[bt]+Et[wt],++S[257+bt],++p[wt],M=c+K,++y}else R[A++]=t[c],++S[t[c]]}}l=er(t,u,i,R,S,p,P,A,D,c-D,l)}return Lr(a,0,n+Tr(l)+o)},lo=function(){var t=1,e=0;return{p:function(r){for(var n=t,o=e,i=r.length,s=0;s!=i;){for(var a=Math.min(s+5552,i);s<a;++s)n+=r[s],o+=n;n%=65521,o%=65521}t=n,e=o},d:function(){return(t>>>8<<16|(e&255)<<8|e>>>8)+((t&255)<<23)*2}}},co=function(t,e,r,n,o){return uo(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,!0)},fo=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8},vo=function(t,e){var r=e.level,n=r==0?0:r<6?1:r==9?3:2;t[0]=120,t[1]=n<<6|(n?32-2*n:1)};function ho(t,e){e===void 0&&(e={});var r=lo();r.p(t);var n=co(t,e,2,4);return vo(n,e),fo(n,n.length-4,r.d()),n}function go(t,e){var r=t.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(t);for(var n=new Q(t.length+(t.length>>>1)),o=0,i=function(l){n[o++]=l},s=0;s<r;++s){if(o+5>n.length){var a=new Q(o+8+(r-s<<1));a.set(n),n=a}var u=t.charCodeAt(s);u<128||e?i(u):u<2048?(i(192|u>>>6),i(128|u&63)):u>55295&&u<57344?(u=65536+(u&1047552)|t.charCodeAt(++s)&1023,i(240|u>>>18),i(128|u>>>12&63),i(128|u>>>6&63),i(128|u&63)):(i(224|u>>>12),i(128|u>>>6&63),i(128|u&63))}return Lr(n,0,o)}function po(t,e){for(var r="",n=0;n<t.length;){var o=t[n++];r+=String.fromCharCode(o)}return r}const yo="v1",mo=t=>{const e={...t,v:yo};return po(ho(go(JSON.stringify(e))))};var So=2e3,Eo=function(){function t(e,r,n,o){var i=this,s,a,u;this.taskQueue=[],this.isProcessing=!1,this.compressEvent=function(f){var h=mo(f);return JSON.stringify(h)},this.addCompressedEventToManager=function(f,h){i.eventsManager&&i.deviceId&&i.eventsManager.addEvent({event:{type:"replay",data:f},sessionId:h,deviceId:i.deviceId})},this.addCompressedEvent=function(f,h){if(i.worker)i.worker.postMessage({event:f,sessionId:h});else{var g=i.compressEvent(f);i.addCompressedEventToManager(g,h)}},this.terminate=function(){var f;(f=i.worker)===null||f===void 0||f.terminate()};var l=j();this.canUseIdleCallback=l&&"requestIdleCallback"in l,this.eventsManager=e,this.config=r,this.deviceId=n,this.timeout=((s=r.performanceConfig)===null||s===void 0?void 0:s.timeout)||So;var c={},v=(a=c.COMPRESSION_WEBWORKER_BODY)!==null&&a!==void 0?a:o;if(!((u=this.config.experimental)===null||u===void 0)&&u.useWebWorker&&l&&l.Worker&&v){r.loggerProvider.log("[Experimental] Enabling web worker for compression");var d=new Worker(URL.createObjectURL(new Blob([v],{type:"application/javascript"})));d.onerror=function(f){r.loggerProvider.error(f)},d.onmessage=function(f){var h=f.data,g=h.compressedEvent,E=h.sessionId;i.addCompressedEventToManager(g,E)},this.worker=d}}return t.prototype.scheduleIdleProcessing=function(){var e=this;this.isProcessing||(this.isProcessing=!0,requestIdleCallback(function(r){e.processQueue(r)},{timeout:this.timeout}))},t.prototype.enqueueEvent=function(e,r){var n;this.canUseIdleCallback&&!((n=this.config.performanceConfig)===null||n===void 0)&&n.enabled?(this.config.loggerProvider.debug("Enqueuing event for processing during idle time."),this.taskQueue.push({event:e,sessionId:r}),this.scheduleIdleProcessing()):(this.config.loggerProvider.debug("Processing event without idle callback."),this.addCompressedEvent(e,r))},t.prototype.processQueue=function(e){for(var r=this;this.taskQueue.length>0&&(e.timeRemaining()>0||e.didTimeout);){var n=this.taskQueue.shift();if(n){var o=n.event,i=n.sessionId;this.addCompressedEvent(o,i)}}this.taskQueue.length>0?requestIdleCallback(function(s){r.processQueue(s)},{timeout:this.timeout}):this.isProcessing=!1},t}();function Ar(t){return t===void 0&&(t={}),{name:"amplitude/url-tracking@1",observer:function(e,r,n){var o,i,s,a=T(T({},t),n),u=a.ugcFilterRules||[],l=(o=a.enablePolling)!==null&&o!==void 0?o:!1,c=(i=a.pollingInterval)!==null&&i!==void 0?i:ar,v=(s=a.captureDocumentTitle)!==null&&s!==void 0?s:!1;if(!r)return function(){};var d=void 0,f=function(){return r.location&&r.location.href||""},h=function(){var S=r.innerHeight,p=r.innerWidth,y=r.document,P=f(),A="";v&&(A=y?.title||"");var M=u.length>0?Ke(P,u):P;return{href:M,title:A,viewportHeight:S,viewportWidth:p,type:"url-change-event"}},g=function(){var S=f();if(d===void 0||S!==d){d=S;var p=h();e(p)}},E=function(S){return function(){for(var p=[],y=0;y<arguments.length;y++)p[y]=arguments[y];var P=S.apply(this,p);return g(),P}},I=function(){g()};if(l){var m=r.setInterval(function(){g()},c);return g(),function(){m&&r.clearInterval(m)}}if(r.history){var b=r.history.pushState.bind(r.history),w=r.history.replaceState.bind(r.history),R=function(){r.history.pushState=E(b),r.history.replaceState=E(w)};return R(),r.addEventListener("popstate",g),r.addEventListener("hashchange",I),g(),function(){r.history.pushState=b,r.history.replaceState=w,r.removeEventListener("popstate",g),r.removeEventListener("hashchange",I)}}return r.addEventListener("hashchange",I),g(),function(){r.removeEventListener("hashchange",I)}},options:t}}Ar();var bo=function(){function t(){var e=this;this.name="@amplitude/session-replay-browser",this.recordCancelCallback=null,this.eventCount=0,this.pageLeaveFns=[],this.recordFunction=null,this.teardownEventListeners=function(r){var n=j();n&&(n.removeEventListener("blur",e.blurListener),n.removeEventListener("focus",e.focusListener),!r&&n.addEventListener("blur",e.blurListener),!r&&n.addEventListener("focus",e.focusListener),n.self&&"onpagehide"in n.self?(n.removeEventListener("pagehide",e.pageLeaveListener),!r&&n.addEventListener("pagehide",e.pageLeaveListener)):(n.removeEventListener("beforeunload",e.pageLeaveListener),!r&&n.addEventListener("beforeunload",e.pageLeaveListener)))},this.blurListener=function(){e.sendEvents()},this.focusListener=function(){e.recordEvents(!1)},this.pageLeaveListener=function(r){e.pageLeaveFns.forEach(function(n){n(r)})},this.addCustomRRWebEvent=function(r,n,o){return n===void 0&&(n={}),o===void 0&&(o=!0),C(e,void 0,void 0,function(){var i,s,a,u;return _(this,function(l){switch(l.label){case 0:return l.trys.push([0,3,,4]),i=void 0,s=this.config,s&&r!==ce.METADATA?(i={config:vr(s),version:it},o?[4,fr()]:[3,2]):[3,2];case 1:a=l.sent(),i=T(T({},a),i),l.label=2;case 2:return this.recordCancelCallback&&this.recordFunction?this.recordFunction.addCustomEvent(r,T(T({},n),i)):this.loggerProvider.debug("Not able to add custom replay capture event ".concat(r," due to no ongoing recording.")),[3,4];case 3:return u=l.sent(),this.loggerProvider.debug("Error while adding custom replay capture event: ",u),[3,4];case 4:return[2]}})})},this.stopRecordingEvents=function(){var r;try{e.loggerProvider.log("Session Replay capture stopping."),e.recordCancelCallback&&e.recordCancelCallback(),e.recordCancelCallback=null,(r=e.networkObservers)===null||r===void 0||r.stop()}catch(o){var n=o;e.loggerProvider.warn("Error occurred while stopping replay capture: ".concat(n.toString()))}},this.loggerProvider=new tt(new Ue)}return t.prototype.init=function(e,r){return At(this._init(e,r))},t.prototype._init=function(e,r){var n,o,i,s,a,u;return C(this,void 0,void 0,function(){var l,c,v,d,f,h,g,E,I,m,S,b,w,R,S;return _(this,function(p){switch(p.label){case 0:return this.loggerProvider=new tt(r.loggerProvider||new Ue),Object.prototype.hasOwnProperty.call(r,"logLevel")&&this.loggerProvider.enable(r.logLevel),this.identifiers=new Ht({sessionId:r.sessionId,deviceId:r.deviceId}),l=this,[4,ii(e,r)];case 1:return l.joinedConfigGenerator=p.sent(),[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)];case 2:c=p.sent(),v=c.joinedConfig,d=c.localConfig,f=c.remoteConfig,this.config=v,this.setMetadata(r.sessionId,v,d,f,(n=r.version)===null||n===void 0?void 0:n.version,it,(o=r.version)===null||o===void 0?void 0:o.type),r.sessionId&&!((i=this.config.interactionConfig)===null||i===void 0)&&i.enabled&&(h=ro.default({sessionId:r.sessionId,type:"interaction"},this.config),this.pageLeaveFns=[h.send(this.getDeviceId.bind(this)).bind(h)],this.scrollHook=h.hook.bind(h)),g=[],E=this.config.storeType,E==="idb"&&!(!((s=j())===null||s===void 0)&&s.indexedDB)&&(E="memory",this.loggerProvider.warn("Could not use preferred indexedDB storage, reverting to in memory option.")),this.loggerProvider.log("Using ".concat(E," for event storage.")),p.label=3;case 3:return p.trys.push([3,5,,6]),[4,Gt({config:this.config,sessionId:this.identifiers.sessionId,type:"replay",storeType:E})];case 4:return I=p.sent(),g.push({name:"replay",manager:I}),[3,6];case 5:return m=p.sent(),S=m,this.loggerProvider.warn("Error occurred while creating replay events manager: ".concat(S.toString())),[3,6];case 6:if(!(!((a=this.config.interactionConfig)===null||a===void 0)&&a.enabled))return[3,10];b=this.config.interactionConfig.batch?Ji:Zi,p.label=7;case 7:return p.trys.push([7,9,,10]),[4,Gt({config:this.config,sessionId:this.identifiers.sessionId,type:"interaction",minInterval:(u=this.config.interactionConfig.trackEveryNms)!==null&&u!==void 0?u:Ln,maxInterval:An,payloadBatcher:b,storeType:E})];case 8:return w=p.sent(),g.push({name:"interaction",manager:w}),[3,10];case 9:return R=p.sent(),S=R,this.loggerProvider.warn("Error occurred while creating interaction events manager: ".concat(S.toString())),[3,10];case 10:return this.eventsManager=new(Wt.bind.apply(Wt,ve([void 0],J(g),!1))),this.eventCompressor&&this.eventCompressor.terminate(),this.eventCompressor=new Eo(this.eventsManager,this.config,this.getDeviceId()),[4,this.initializeNetworkObservers()];case 11:return p.sent(),this.loggerProvider.log("Installing @amplitude/session-replay-browser."),this.teardownEventListeners(!1),this.initialize(!0),[2]}})})},t.prototype.setSessionId=function(e,r){return At(this.asyncSetSessionId(e,r))},t.prototype.asyncSetSessionId=function(e,r){return C(this,void 0,void 0,function(){var n,o,i;return _(this,function(s){switch(s.label){case 0:return n=this.identifiers&&this.identifiers.sessionId,n&&this.sendEvents(n),o=r||this.getDeviceId(),this.identifiers=new Ht({sessionId:e,deviceId:o}),this.joinedConfigGenerator&&n?[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)]:[3,2];case 1:i=s.sent().joinedConfig,this.config=i,s.label=2;case 2:return this.recordEvents(),[2]}})})},t.prototype.getSessionReplayProperties=function(){var e,r=this.config,n=this.identifiers;if(!r||!n)return this.loggerProvider.warn("Session replay init has not been called, cannot get session replay properties."),{};var o=this.getShouldRecord(),i={};return o&&(i=(e={},e[mn]=n.sessionReplayId?n.sessionReplayId:null,e),r.debugMode&&(i[wn]=JSON.stringify({appHash:nt(r.apiKey).toString()}))),this.addCustomRRWebEvent(ce.GET_SR_PROPS,{shouldRecord:o,eventProperties:i},this.eventCount===10),this.eventCount===10&&(this.eventCount=0),this.eventCount++,i},t.prototype.sendEvents=function(e){var r,n=e||((r=this.identifiers)===null||r===void 0?void 0:r.sessionId),o=this.getDeviceId();this.eventsManager&&n&&o&&this.eventsManager.sendCurrentSequenceEvents({sessionId:n,deviceId:o})},t.prototype.initialize=function(e){var r;return e===void 0&&(e=!1),C(this,void 0,void 0,function(){var n;return _(this,function(o){return!((r=this.identifiers)===null||r===void 0)&&r.sessionId?(n=this.getDeviceId(),n?(this.eventsManager&&e&&this.eventsManager.sendStoredEvents({deviceId:n}),[2,this.recordEvents()]):(this.loggerProvider.log("Session is not being recorded due to lack of device id."),[2,Promise.resolve()])):(this.loggerProvider.log("Session is not being recorded due to lack of session id."),[2,Promise.resolve()])})})},t.prototype.shouldOptOut=function(){var e,r,n;if(!((e=this.config)===null||e===void 0)&&e.instanceName){var o=gn(this.config.instanceName).identityStore;n=o.getIdentity().optOut}return n!==void 0?n:(r=this.config)===null||r===void 0?void 0:r.optOut},t.prototype.getShouldRecord=function(){if(!this.identifiers||!this.config||!this.identifiers.sessionId)return this.loggerProvider.warn("Session is not being recorded due to lack of config, please call sessionReplay.init."),!1;if(!this.config.captureEnabled)return this.loggerProvider.log("Session ".concat(this.identifiers.sessionId," not being captured due to capture being disabled for project or because the remote config could not be fetched.")),!1;if(this.shouldOptOut())return this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to optOut config.")),!1;var e=Bn(this.identifiers.sessionId,this.config.sampleRate);return e||this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to sample rate.")),e},t.prototype.getBlockSelectors=function(){var e,r,n,o=(n=(r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.blockSelector)!==null&&n!==void 0?n:[];if(o.length!==0)return o},t.prototype.getMaskTextSelectors=function(){var e,r,n,o;if(((r=(e=this.config)===null||e===void 0?void 0:e.privacyConfig)===null||r===void 0?void 0:r.defaultMaskLevel)==="conservative")return"*";var i=(o=(n=this.config)===null||n===void 0?void 0:n.privacyConfig)===null||o===void 0?void 0:o.maskSelector;if(i)return i},t.prototype.getRecordingPlugins=function(e){var r,n,o,i,s,a;return C(this,void 0,void 0,function(){var u,l,c,v;return _(this,function(d){switch(d.label){case 0:u=[];try{l=Ar({ugcFilterRules:((n=(r=this.config)===null||r===void 0?void 0:r.interactionConfig)===null||n===void 0?void 0:n.ugcFilterRules)||[],enablePolling:((o=this.config)===null||o===void 0?void 0:o.enableUrlChangePolling)||!1,pollingInterval:(i=this.config)===null||i===void 0?void 0:i.urlChangePollingInterval,captureDocumentTitle:(s=this.config)===null||s===void 0?void 0:s.captureDocumentTitle}),u.push(l)}catch(f){this.loggerProvider.warn("Failed to create URL tracking plugin:",f)}if(!(!((a=e?.console)===null||a===void 0)&&a.enabled))return[3,4];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,ze(()=>import("./rrweb-plugin-console-record.js"),[],import.meta.url)];case 2:return c=d.sent().getRecordConsolePlugin,u.push(c({level:e.console.levels})),[3,4];case 3:return v=d.sent(),this.loggerProvider.warn("Failed to load console plugin:",v),[3,4];case 4:return[2,u.length>0?u:void 0]}})})},t.prototype.getRecordFunction=function(){return C(this,void 0,void 0,function(){var e,r;return _(this,function(n){switch(n.label){case 0:if(this.recordFunction)return[2,this.recordFunction];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,ze(()=>import("./rrweb-record.js"),[],import.meta.url)];case 2:return e=n.sent().record,this.recordFunction=e,[2,e];case 3:return r=n.sent(),this.loggerProvider.warn("Failed to load rrweb-record module:",r),[2,null];case 4:return[2]}})})},t.prototype.recordEvents=function(e){var r,n,o,i,s;return e===void 0&&(e=!0),C(this,void 0,void 0,function(){var a,u,l,c,v,d,f,h,g,E,I,m,b,w=this;return _(this,function(R){switch(R.label){case 0:return a=this.config,u=this.getShouldRecord(),l=(r=this.identifiers)===null||r===void 0?void 0:r.sessionId,!u||!l||!a?[2]:(this.stopRecordingEvents(),[4,this.getRecordFunction()]);case 1:return c=R.sent(),c?[4,this.initializeNetworkObservers()]:[2];case 2:R.sent(),(n=this.networkObservers)===null||n===void 0||n.start(function(S){w.addCustomRRWebEvent(ce.FETCH_REQUEST,S)}),v=a.privacyConfig,d=a.interactionConfig,f=a.loggingConfig,h=d!=null&&d.enabled?{mouseInteraction:this.eventsManager&&eo(this.loggerProvider,{eventsManager:this.eventsManager,sessionId:l,deviceIdFn:this.getDeviceId.bind(this),mirror:c.mirror,ugcFilterRules:(o=d.ugcFilterRules)!==null&&o!==void 0?o:[]}),scroll:this.scrollHook}:{},g=d!=null&&d.enabled&&d.ugcFilterRules?d.ugcFilterRules:[],this.loggerProvider.log("Session Replay capture beginning for ".concat(l,".")),R.label=3;case 3:return R.trys.push([3,5,,6]),E=this,I=c,b={emit:function(S){if(w.shouldOptOut()){w.loggerProvider.log("Opting session ".concat(l," out of recording due to optOut config.")),w.stopRecordingEvents(),w.sendEvents();return}S.type===gr.Meta&&(S.data.href=Ke(S.data.href,g)),w.eventCompressor&&w.eventCompressor.enqueueEvent(S,l)},inlineStylesheet:a.shouldInlineStylesheet,hooks:h,maskAllInputs:!0,maskTextClass:ur,blockClass:In,blockSelector:this.getBlockSelectors(),applyBackgroundColorToBlockedElements:a.applyBackgroundColorToBlockedElements,maskInputFn:kt("input",v),maskTextFn:kt("text",v),maskTextSelector:this.getMaskTextSelectors(),recordCanvas:!1,slimDOMOptions:{script:(i=a.omitElementTags)===null||i===void 0?void 0:i.script,comment:(s=a.omitElementTags)===null||s===void 0?void 0:s.comment},errorHandler:function(S){var p=S;if(p.message.includes("insertRule")&&p.message.includes("CSSStyleSheet")||p._external_)throw p;return w.loggerProvider.warn("Error while capturing replay: ",p.toString()),!0}},[4,this.getRecordingPlugins(f)];case 4:return E.recordCancelCallback=I.apply(void 0,[(b.plugins=R.sent(),b)]),this.addCustomRRWebEvent(ce.DEBUG_INFO),e&&this.addCustomRRWebEvent(ce.METADATA,this.metadata),[3,6];case 5:return m=R.sent(),this.loggerProvider.warn("Failed to initialize session replay:",m),[3,6];case 6:return[2]}})})},t.prototype.getDeviceId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.deviceId},t.prototype.getSessionId=function(){var e;return(e=this.identifiers)===null||e===void 0?void 0:e.sessionId},t.prototype.flush=function(e){var r;return e===void 0&&(e=!1),C(this,void 0,void 0,function(){return _(this,function(n){return[2,(r=this.eventsManager)===null||r===void 0?void 0:r.flush(e)]})})},t.prototype.shutdown=function(){this.teardownEventListeners(!0),this.stopRecordingEvents(),this.sendEvents()},t.prototype.mapSDKType=function(e){return e==="plugin"?"@amplitude/plugin-session-replay-browser":e==="segment"?"@amplitude/segment-session-replay-plugin":null},t.prototype.setMetadata=function(e,r,n,o,i,s,a){var u=e!=null&&e.toString()?nt(e.toString()):void 0;this.metadata={joinedConfig:r,localConfig:n,remoteConfig:o,sessionId:e,hashValue:u,sampleRate:r.sampleRate,replaySDKType:this.mapSDKType(a),replaySDKVersion:i,standaloneSDKType:"@amplitude/session-replay-browser",standaloneSDKVersion:s}},t.prototype.initializeNetworkObservers=function(){var e,r,n;return C(this,void 0,void 0,function(){var o,i;return _(this,function(s){switch(s.label){case 0:if(!(!((n=(r=(e=this.config)===null||e===void 0?void 0:e.loggingConfig)===null||r===void 0?void 0:r.network)===null||n===void 0)&&n.enabled&&!this.networkObservers))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,ze(()=>import("./observers.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url)];case 2:return o=s.sent().NetworkObservers,this.networkObservers=new o,[3,4];case 3:return i=s.sent(),this.loggerProvider.warn("Failed to import or instantiate NetworkObservers:",i),[3,4];case 4:return[2]}})})},t}(),me=function(t){return function(){var e=t.config,r=e||hr(),n=r.loggerProvider,o=r.logLevel;return{logger:n,logLevel:o}}},wo=function(){var t=new bo;return{init:pe(t.init.bind(t),"init",me(t)),setSessionId:pe(t.setSessionId.bind(t),"setSessionId",me(t)),getSessionId:pe(t.getSessionId.bind(t),"getSessionId",me(t)),getSessionReplayProperties:pe(t.getSessionReplayProperties.bind(t),"getSessionReplayProperties",me(t)),flush:pe(t.flush.bind(t),"flush",me(t)),shutdown:pe(t.shutdown.bind(t),"shutdown",me(t))}};const Dr=wo();var Io=Dr.init,Ro=Dr.getSessionReplayProperties;const tr="[Amplitude] Session Replay ID",_o=()=>{const t=window.ALLBIRDS.settings.amplitude;if(window.ALLBIRDS.settings.amplitude.INITIALIZED!==!0){if(t.sessionReplayEnabled===!1||t.apiKey===void 0){It("[Allbirds pixel] - Amplitude - Session Replay not enabled",{amplitudeApiKey:t.apiKey,sessionReplayEnabled:t.sessionReplayEnabled},new Error("Session Replay not enabled"));return}return new Promise(e=>{gt(async()=>{const r=Nr();window.ALLBIRDS.OneTrust.hasPerformanceConsent()&&await Io(t.apiKey,{deviceId:r.anonymousId,optOut:!1,sampleRate:t.sessionReplaySampleRate,sessionId:window.rudderanalytics.getSessionId()}).promise;const o=Ro();setTimeout(()=>{const s=o?.[tr];if(!s){It("[Allbirds pixel] - Amplitude - [Amplitude] Session Replay ID - not found ",{sessionId:s},new Error("Session Replay ID not found"));return}const a=rr();nr({additionalTraits:{fbclid:a.fbclid,gclid:a.gclid,msclkid:a.msclkid,session_replay_session_id:s},email:null}),qr(s),window.ALLBIRDS.settings.amplitude.INITIALIZED=!0,window.TrackJS&&s&&window.TrackJS.addMetadata(tr,s),e()},500)},pt.AMPLITUDE_INIT_SESSION_REPLAY)})}},Co=window.ALLBIRDS.environment.isUsStore||window.ALLBIRDS.environment.isUkStore;Co&&_o();export{C as _,_ as a,j as g};
//# sourceMappingURL=/cdn/shop/t/2799/assets/theme2.js.map
