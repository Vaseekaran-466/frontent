import{w as c,i as O}from"./shopify.js";import{c as b,r as l,k as u,o as L,a as A}from"./vue.esm-bundler.js";import{g as w,G as i,s as f}from"./cookies.js";import{G as d,a as S,b as y}from"./geofencing2.js";import{B as I}from"./base-section.js";class T extends I{constructor(){super('[data-section-type="geofencing"]')}init(R){const g=R.container,k=w(i.USER_INFERRED_COUNTRY),p=w(i.USER_SELECTED_SHOP),a=g.getAttribute("data-shop-country");b({name:"GeofencingSection",setup(){const t=l(!1),n=l(k||null),s=l(p||a||null),_=u(()=>[d[S.US],...Object.values(d).filter(e=>e.id!==S.US).sort((e,o)=>e.name.localeCompare(o.name))]),U=u(()=>{var e;return!!((e=y[n.value])!=null&&e.length)}),N=u(()=>y[n.value]||[]),E=()=>{const e=N.value.at(0);e&&a===n.value&&(s.value=e),n.value!==a&&(t.value=!0)},m=()=>{f(i.USER_SELECTED_SHOP,s.value),t.value=!1},C=e=>{e.key==="Escape"&&t.value&&m()},P=e=>{const o=d[S[e]];if(!(o!=null&&o.url)||!o.id){c("[Allbirds section] - Geofencing - handleShopSelection - Shop not found or has no URL",{shopId:e},new Error("Shop not found or has no URL"));return}s.value=o.id,f(i.USER_SELECTED_SHOP,o.id),window.location.href=o.url},F=()=>{var e,o;(o=(e=window.Shopify)==null?void 0:e.loadFeatures)==null||o.call(e,[{name:"consent-tracking-api",version:"0.1"}],function(G){var h,v;if(G){c("[Allbirds section] - Geofencing - setGeoFencingCookie - Error setting geofencing cookie",{},G);return}if(O("[Allbirds section] - Geofencing - setGeoFencingCookie - Successfully loaded shopify consent-tracking-api",{}),(v=(h=window.Shopify)==null?void 0:h.customerPrivacy)!=null&&v.getRegion&&typeof window.Shopify.customerPrivacy.getRegion=="function"){const r=window.Shopify.customerPrivacy.getRegion().slice(0,2);r&&!n.value?(f(i.USER_INFERRED_COUNTRY,r),n.value=r,E(),O("[Allbirds section] - Geofencing - setGeoFencingCookie - Successfully set user region cookie",{userRegion:r})):c("[Allbirds section] - Geofencing - setGeoFencingCookie - Error User region not found",{},new Error("User region not found"))}})};return L(()=>{if(new URLSearchParams(window.location.search).get("geofenceoff")==="true"){c("[Allbirds section] - Geofencing - onMounted - Not loaded, geofenceoff parameter is true",{},new Error("Not loaded, geofenceoff parameter is true"));return}p||(F(),n.value&&E()),t.value&&document.addEventListener("keydown",C)}),A(()=>{document.removeEventListener("keydown",C)}),{availableShops:_,handleModalClose:m,handleShopSelection:P,isGeofencingModalOpen:t,isSupportedCountry:U,userCountryIso:n,userSelectedShop:s}}}).mount(g)}}document.addEventListener("DOMContentLoaded",()=>{new T});
//# sourceMappingURL=geofencing.js.map
